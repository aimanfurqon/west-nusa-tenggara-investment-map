<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Investasi NTB - Presentasi Interaktif</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary-blue: #2563eb;
            --primary-green: #059669;
            --accent-gold: #f59e0b;
            --dark-blue: #1e3a8a;
            --light-bg: #f8fafc;
            --white: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --border-light: #e5e7eb;
            --hover-bg: #f3f4f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow: hidden;
        }

        .presentation-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Header Presentation */
        .presentation-header {
            background: var(--white);
            padding: 20px 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            height: 60px;
            width: auto;
        }

        .title-section h1 {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .title-section p {
            color: var(--text-light);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .presentation-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            padding: 8px 12px;
            border: 2px solid var(--primary-blue);
            background: var(--white);
            color: var(--primary-blue);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .control-btn:hover, .control-btn.active {
            background: var(--primary-blue);
            color: var(--white);
        }

        /* Main Content Area */
        .content-area {
            flex: 1;
            display: flex;
            background: var(--white);
            position: relative;
        }

        /* Slide Navigation */
        .slide-navigation {
            width: 300px;
            background: var(--light-bg);
            border-right: 1px solid var(--border-light);
            overflow-y: auto;
            padding: 20px;
        }

        .nav-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Search Box */
        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 2px solid var(--border-light);
            border-radius: 10px;
            font-size: 0.9rem;
            background: var(--white);
            transition: all 0.3s ease;
            outline: none;
        }

        .search-input:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .search-clear {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: none;
        }

        .search-clear:hover {
            background: var(--hover-bg);
            color: var(--text-dark);
        }

        .search-clear.show {
            display: block;
        }

        .region-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
            padding-right: 5px;
        }

        /* Custom scrollbar for region list */
        .region-list::-webkit-scrollbar {
            width: 6px;
        }

        .region-list::-webkit-scrollbar-track {
            background: var(--border-light);
            border-radius: 3px;
        }

        .region-list::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 3px;
        }

        .region-list::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }

        .region-item {
            padding: 15px;
            background: var(--white);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .region-item:hover {
            border-color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15);
        }

        .region-item.active {
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%);
        }

        .region-name {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .region-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .region-item.hidden {
            display: none;
        }

        .no-results {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-light);
            display: none;
        }

        .no-results.show {
            display: block;
        }

        .no-results i {
            font-size: 2rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Main Slide Area */
        .slide-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            position: relative;
        }

        .slide {
            display: none;
            animation: slideIn 0.5s ease-in-out;
        }

        .slide.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Welcome Slide */
        .welcome-slide {
            text-align: center;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .welcome-icon {
            font-size: 4rem;
            color: var(--primary-blue);
            margin-bottom: 30px;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 20px;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            margin-bottom: 40px;
            max-width: 600px;
            line-height: 1.6;
        }

        .welcome-instructions {
            background: var(--light-bg);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid var(--primary-blue);
            max-width: 500px;
        }

        .welcome-instructions h3 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .welcome-instructions p {
            color: var(--text-light);
            line-height: 1.5;
        }

        /* Region Detail Slide */
        .region-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--border-light);
            flex-wrap: wrap;
            gap: 20px;
        }

        .sector-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .sector-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--light-bg);
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .sector-toggle:hover {
            background: var(--border-light);
        }

        .sector-toggle.active {
            background: var(--primary-blue);
            color: var(--white);
        }

        .sector-count-info {
            font-size: 0.8rem;
            color: var(--text-light);
            padding: 8px 12px;
            background: var(--light-bg);
            border-radius: 8px;
        }

        .region-detail-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .region-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
        }

        .region-title-text h2 {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .region-title-text p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .region-stats-summary {
            display: flex;
            gap: 20px;
            text-align: center;
        }

        .stat-item {
            padding: 10px 15px;
            background: var(--light-bg);
            border-radius: 10px;
            border-bottom: 3px solid var(--primary-blue);
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
            font-weight: 500;
        }

        /* Sector Grid */
        .sectors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            padding-right: 10px;
        }

        /* Custom scrollbar for sectors grid */
        .sectors-grid::-webkit-scrollbar {
            width: 8px;
        }

        .sectors-grid::-webkit-scrollbar-track {
            background: var(--light-bg);
            border-radius: 4px;
        }

        .sectors-grid::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 4px;
        }

        .sectors-grid::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }

        .sector-card {
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .sector-card.no-data {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .sector-card.no-data:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-color: transparent;
        }

        .sector-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-blue), var(--primary-green));
        }

        .sector-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(37, 99, 235, 0.15);
            border-color: var(--primary-blue);
        }

        .sector-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .sector-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.2rem;
        }

        .sector-info h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .sector-count {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .sector-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sector-investment {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary-green);
        }

        .sector-arrow {
            color: var(--primary-blue);
            font-size: 1.2rem;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .sector-card:hover .sector-arrow {
            opacity: 1;
            transform: translateX(5px);
        }

        /* Sector Detail Modal */
        .sector-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .sector-modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            width: 100%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            color: var(--white);
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 30px;
            max-height: calc(90vh - 100px);
            overflow-y: auto;
        }

        .top-investors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .investor-card {
            background: var(--light-bg);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid var(--primary-blue);
            transition: all 0.3s ease;
        }

        .investor-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .investor-rank {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .rank-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-gold), #f97316);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .rank-number.gold { background: linear-gradient(135deg, #ffd700, #ffb300); }
        .rank-number.silver { background: linear-gradient(135deg, #c0c0c0, #a8a8a8); }
        .rank-number.bronze { background: linear-gradient(135deg, #cd7f32, #b8860b); }

        .investor-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1.3;
        }

        .investor-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .detail-icon {
            color: var(--primary-blue);
        }

        .investor-investment {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-green);
            text-align: center;
            padding: 10px;
            background: var(--white);
            border-radius: 10px;
            margin-top: 10px;
        }

        .investor-type {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: auto;
        }

        .investor-type.PMA {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .investor-type.PMDN {
            background: #dcfce7;
            color: #166534;
        }

        /* No Data State */
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .no-data i {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        /* Navigation Buttons */
        .slide-navigation-bottom {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .nav-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-blue);
            color: var(--white);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Progress Bar */
        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            height: 4px;
            background: var(--primary-blue);
            transition: width 0.3s ease;
            z-index: 100;
        }

        /* Map Overview Slide */
        .map-overview-slide {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
        }

        .map-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .map-title h2 {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
        }

        .map-controls {
            display: flex;
            gap: 10px;
        }

        .map-control-btn {
            padding: 8px 12px;
            border: 2px solid var(--primary-blue);
            background: var(--white);
            color: var(--primary-blue);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .map-control-btn:hover, .map-control-btn.active {
            background: var(--primary-blue);
            color: var(--white);
        }

        .map-container {
            flex: 1;
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            min-height: 500px;
        }

        #presentationMap {
            width: 100%;
            height: 100%;
            min-height: 500px;
        }

        .map-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 200px;
        }

        .legend-title {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
        }

        .legend-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        .legend-marker.ibu-kota {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .legend-marker.kota {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .legend-marker.kabupaten {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .map-stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 250px;
        }

        .stats-title {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 12px;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stats-item {
            text-align: center;
            padding: 8px;
            background: var(--light-bg);
            border-radius: 6px;
        }

        .stats-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .stats-label {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        /* Custom Leaflet Popup */
        .leaflet-popup-content-wrapper {
            border-radius: 12px !important;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
            padding: 0 !important;
        }

        .leaflet-popup-content {
            margin: 0 !important;
            padding: 0 !important;
            min-width: 250px !important;
        }

        .leaflet-popup-close-button {
            top: 10px !important;
            right: 10px !important;
            width: 20px !important;
            height: 20px !important;
            font-size: 16px !important;
            color: white !important;
            background: rgba(0,0,0,0.3) !important;
            border-radius: 50% !important;
            text-align: center !important;
            line-height: 20px !important;
        }

        .leaflet-popup-close-button:hover {
            background: rgba(0,0,0,0.5) !important;
        }

        .map-popup {
            min-width: 250px;
            font-family: 'Inter', sans-serif;
        }

        .popup-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            color: white;
            padding: 15px;
            text-align: center;
        }

        .popup-region-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .popup-region-type {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .popup-body {
            padding: 15px;
        }

        .popup-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .popup-stat {
            text-align: center;
            padding: 8px;
            background: var(--light-bg);
            border-radius: 6px;
        }

        .popup-stat-value {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .popup-stat-label {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        .popup-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .popup-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .popup-btn.primary {
            background: var(--primary-blue);
            color: white;
        }

        .popup-btn.primary:hover {
            background: var(--dark-blue);
        }

        .popup-btn.secondary {
            background: var(--light-bg);
            color: var(--text-dark);
        }

        .popup-btn.secondary:hover {
            background: var(--border-light);
        }

        /* Map Navigation Button */
        .map-nav-button {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
            z-index: 1001;
        }

        .map-nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
        }
        @media (max-width: 1024px) {
            .content-area {
                flex-direction: column;
            }
            
            .slide-navigation {
                width: 100%;
                max-height: 200px;
                order: 2;
            }
            
            .region-list {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 10px;
            }
            
            .sectors-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                max-height: calc(100vh - 350px);
            }
            
            .region-detail-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .region-stats-summary {
                width: 100%;
                justify-content: space-between;
            }
            
            .sector-controls {
                width: 100%;
                justify-content: space-between;
            }
        }
        

        @media (max-width: 768px) {
            .presentation-header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }
            
            .header-right {
                justify-content: center;
            }
            
            .slide-content {
                padding: 20px;
            }
            
            .sectors-grid {
                grid-template-columns: 1fr;
            }
            
            .top-investors-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10px;
                max-height: calc(100vh - 20px);
            }
        }

        /* Smooth Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
    </style>
</head>
<body>
    <div class="presentation-container">
        <!-- Header -->
        <div class="presentation-header">
            <div class="header-left">
                <div class="logo-container">
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #2563eb, #059669); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                        NTB
                    </div>
                </div>
                <div class="title-section">
                    <h1>Dashboard Investasi NTB</h1>
                    <p>Dinas Penanaman Modal dan Pelayanan Terpadu Satu Pintu</p>
                </div>
            </div>
            <div class="header-right">
                <div class="presentation-controls">
                    <button class="control-btn active" onclick="resetPresentation()">
                        <i class="fas fa-home"></i> Beranda
                    </button>
                    <button class="control-btn" onclick="showMapOverview()">
                        <i class="fas fa-map"></i> Peta NTB
                    </button>
                    <button class="control-btn" onclick="toggleFullscreen()">
                        <i class="fas fa-expand"></i> Fullscreen
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content-area">
            <!-- Region Navigation -->
            <div class="slide-navigation">
                <div class="nav-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Wilayah NTB
                </div>
                
                <!-- Search Box -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input 
                        type="text" 
                        class="search-input" 
                        id="regionSearch" 
                        placeholder="Cari wilayah..."
                        autocomplete="off"
                    >
                    <button class="search-clear" id="searchClear" onclick="clearSearch()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="region-list" id="regionList">
                    <!-- Regions will be populated by JavaScript -->
                </div>
                
                <!-- No Results Message -->
                <div class="no-results" id="noResults">
                    <i class="fas fa-search"></i>
                    <div>Tidak ada wilayah yang ditemukan</div>
                    <small>Coba kata kunci lain</small>
                </div>
            </div>

            <!-- Slide Content -->
            <div class="slide-content">
                <!-- Welcome Slide -->
                <div class="slide active" id="welcomeSlide">
                    <div class="welcome-slide">
                        <div class="welcome-icon">
                            <i class="fas fa-presentation"></i>
                        </div>
                        <h1 class="welcome-title">Presentasi Investasi NTB</h1>
                        <p class="welcome-subtitle">
                            Jelajahi data investasi real-time dari 10 kabupaten/kota di Nusa Tenggara Barat 
                            dengan detail 16 sektor ekonomi dan profil investor terkemuka.
                        </p>
                        <div class="welcome-instructions">
                            <h3><i class="fas fa-info-circle"></i> Cara Penggunaan</h3>
                            <p>
                                • Pilih wilayah di panel kiri untuk melihat detail investasi<br>
                                • Klik sektor untuk melihat top 10 investor terbesar<br>
                                • Tekan "/" untuk fokus ke pencarian wilayah<br>
                                • Gunakan tombol navigasi untuk berpindah antar slide<br>
                                • Klik fullscreen untuk pengalaman presentasi optimal<br>
                                • Klik "Peta NTB" untuk melihat overview geografis
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Map Overview Slide -->
                <div class="slide" id="mapOverviewSlide">
                    <div class="map-overview-slide">
                        <div class="map-header">
                            <div class="map-title">
                                <i class="fas fa-map-marked-alt"></i>
                                <h2>Peta Investasi NTB</h2>
                            </div>
                            <div class="map-controls">
                                <button class="map-control-btn active" onclick="resetMapView()">
                                    <i class="fas fa-home"></i> Reset View
                                </button>
                                <button class="map-control-btn" onclick="toggleMapFullscreen()">
                                    <i class="fas fa-expand"></i> Fullscreen Map
                                </button>
                            </div>
                        </div>
                        <div class="map-container">
                            <div id="presentationMap"></div>
                            
                            <!-- Map Legend -->
                            <div class="map-legend">
                                <div class="legend-title">Keterangan</div>
                                <div class="legend-items">
                                    <div class="legend-item">
                                        <div class="legend-marker ibu-kota">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <span>Ibu Kota Provinsi</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-marker kota">
                                            <i class="fas fa-building"></i>
                                        </div>
                                        <span>Kota</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-marker kabupaten">
                                            <i class="fas fa-mountain"></i>
                                        </div>
                                        <span>Kabupaten</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Map Stats -->
                            <div class="map-stats">
                                <div class="stats-title">Statistik Investasi</div>
                                <div class="stats-grid">
                                    <div class="stats-item">
                                        <div class="stats-value" id="mapTotalRegions">10</div>
                                        <div class="stats-label">Wilayah</div>
                                    </div>
                                    <div class="stats-item">
                                        <div class="stats-value" id="mapTotalCompanies">0</div>
                                        <div class="stats-label">Perusahaan</div>
                                    </div>
                                    <div class="stats-item">
                                        <div class="stats-value" id="mapTotalSectors">16</div>
                                        <div class="stats-label">Sektor</div>
                                    </div>
                                    <div class="stats-item">
                                        <div class="stats-value" id="mapTotalInvestment">0</div>
                                        <div class="stats-label">Total Investasi</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Region Detail Slides will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Sector Detail Modal -->
    <div class="sector-modal" id="sectorModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">
                    <i class="fas fa-industry"></i>
                    <span>Detail Sektor</span>
                </div>
                <button class="modal-close" onclick="closeSectorModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="slide-navigation-bottom">
        <button class="nav-btn" id="prevBtn" onclick="previousSlide()" disabled>
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="nav-btn" id="nextBtn" onclick="nextSlide()">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <!-- Map Navigation Button -->
    <button class="map-nav-button" id="mapNavButton" onclick="showMapOverview()" title="Lihat Peta NTB">
        <i class="fas fa-map-marked-alt"></i>
    </button>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar"></div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Data investasi berdasarkan file yang diberikan
        const investmentData = {
            "Mataram": {
                name: "Mataram",
                type: "Ibu Kota",
                population: "441,546",
                totalInvestment: 3044235580377,
                totalCompanies: 5,
                sectors: {
                    "Telekomunikasi": [
                        {
                            name: "XLSMART TELECOM SEJAHTERA",
                            investment: 1827358609517,
                            type: "PMA",
                            kbli: "61200",
                            district: "Mataram",
                            description: "Aktivitas Telekomunikasi Tanpa Kabel"
                        },
                        {
                            name: "INDOSAT",
                            investment: 253927304487,
                            type: "PMA",
                            kbli: "61200",
                            district: "Mataram",
                            description: "Aktivitas Telekomunikasi Tanpa Kabel"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "AGRINDO NUSANTARA",
                            investment: 727830634210,
                            type: "PMDN",
                            kbli: "46319",
                            district: "Sandubaya",
                            description: "Perdagangan Besar Bahan Makanan Dan Minuman Hasil Pertanian Lainnya"
                        },
                        {
                            name: "BINTANG BALI INDAH",
                            investment: 117033565000,
                            type: "PMDN",
                            kbli: "46333",
                            district: "Sandubaya",
                            description: "Perdagangan Besar Minuman Beralkohol"
                        }
                    ],
                    "Kelautan dan Perikanan": [
                        {
                            name: "AIR MINUM GIRI MENANG",
                            investment: 118085467163,
                            type: "PMDN",
                            kbli: "36001",
                            district: "Selaprang",
                            description: "Penampungan, Penjernihan dan Penyaluran Air Minum"
                        }
                    ]
                }
            },
            "Lombok Barat": {
                name: "Lombok Barat",
                type: "Kabupaten",
                population: "679,871",
                totalInvestment: 1797146623935,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "PELAYANAN LISTRIK NASIONAL BATAM",
                            investment: 927119472934,
                            type: "PMDN",
                            kbli: "35111",
                            district: "Gerung",
                            description: "Pembangkitan Tenaga Listrik"
                        }
                    ],
                    "Pariwisata dan Ekonomi Kreatif": [
                        {
                            name: "BLISS PEMBANGUNAN SEJAHTERA",
                            investment: 419637796264,
                            type: "PMDN",
                            kbli: "68111",
                            district: "Narmada",
                            description: "Real Estat Yang Dimiliki Sendiri Atau Disewa"
                        },
                        {
                            name: "GRAHA SENGGIGI",
                            investment: 149658714241,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Batu Layar",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "RAJAWALI ADIMANDALIKA",
                            investment: 129264000000,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Batu Layar",
                            description: "Hotel Bintang"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "NARMADA AWET MUDA",
                            investment: 171066640896,
                            type: "PMDN",
                            kbli: "11051",
                            district: "Lingsar",
                            description: "Industri Air Kemasan"
                        }
                    ]
                }
            },
            "Lombok Tengah": {
                name: "Lombok Tengah",
                type: "Kabupaten",
                population: "980,167",
                totalInvestment: 12195893056730,
                totalCompanies: 5,
                sectors: {
                    "Pariwisata dan Ekonomi Kreatif": [
                        {
                            name: "PENGEMBANGAN PARIWISATA INDONESIA",
                            investment: 9009123215123,
                            type: "PMDN",
                            kbli: "68120",
                            district: "-",
                            description: "Kawasan Pariwisata"
                        },
                        {
                            name: "LOMBOK INVEST AND DEVELOPMENT",
                            investment: 472873030683,
                            type: "PMA",
                            kbli: "55194",
                            district: "Praya Barat",
                            description: "Apartemen Hotel"
                        },
                        {
                            name: "LAPORTE KELUARGA SEJAHTRA",
                            investment: 96583321638,
                            type: "PMA",
                            kbli: "55194",
                            district: "Praya Barat",
                            description: "Apartemen Hotel"
                        }
                    ],
                    "ESDM": [
                        {
                            name: "GOODWIND POWER INDONESIA",
                            investment: 1606800000000,
                            type: "PMDN",
                            kbli: "35111",
                            district: "Pujut",
                            description: "Pembangkitan Tenaga Listrik"
                        }
                    ]
                }
            },
            "Lombok Timur": {
                name: "Lombok Timur",
                type: "Kabupaten",
                population: "1,325,240",
                totalInvestment: 1779778484656,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "PT. PERUSAHAAN LISTRIK NEGARA",
                            investment: 1407288042467,
                            type: "PMDN",
                            kbli: "35115",
                            district: "Sambelia",
                            description: "Pembangkit, Transmisi, Distribusi dan Penjualan Tenaga Listrik"
                        },
                        {
                            name: "DELAPAN MENIT ENERGI",
                            investment: 144729626405,
                            type: "PMA",
                            kbli: "35111",
                            district: "Sambelia",
                            description: "Pembangkitan Tenaga Listrik"
                        },
                        {
                            name: "IRADAT AMAN",
                            investment: 111364559251,
                            type: "PMDN",
                            kbli: "35111",
                            district: "Pringgabaya",
                            description: "Pembangkitan Tenaga Listrik"
                        }
                    ],
                    "Peternakan": [
                        {
                            name: "CHAROEN POKPHAND JAYA FARM",
                            investment: 79422227020,
                            type: "PMDN",
                            kbli: "01468",
                            district: "Pringgabaya",
                            description: "Pembibitan Ayam Ras"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "DOK DAN PERKAPALAN AIR KANTUNG",
                            investment: 36974027513,
                            type: "PMDN",
                            kbli: "33151",
                            district: "Pringgabaya",
                            description: "Reparasi Kapal, Perahu Dan Bangunan Terapung"
                        }
                    ]
                }
            },
            "Lombok Utara": {
                name: "Lombok Utara",
                type: "Kabupaten",
                population: "230,899",
                totalInvestment: 864942150646,
                totalCompanies: 5,
                sectors: {
                    "Pariwisata dan Ekonomi Kreatif": [
                        {
                            name: "WAKA OBEROI INDONESIA",
                            investment: 298277153856,
                            type: "PMA",
                            kbli: "55110",
                            district: "Tanjung",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "JAYA HAMPARAN LOMBOK",
                            investment: 166778174203,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Pemenang",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "MEKARAYA INTERNUSA",
                            investment: 162535939853,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Tanjung",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "PRAPAT AGUNG PERMAI",
                            investment: 120899357655,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Pemenang",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "WALTER PROPERTINDO JAYA",
                            investment: 116451525079,
                            type: "PMDN",
                            kbli: "55113",
                            district: "Pemenang",
                            description: "Hotel Bintang Tiga"
                        }
                    ]
                }
            },
            "Sumbawa": {
                name: "Sumbawa",
                type: "Kabupaten",
                population: "439,909",
                totalInvestment: 1629958323189,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "PT. PERUSAHAAN LISTRIK NEGARA",
                            investment: 531151255969,
                            type: "PMDN",
                            kbli: "35115",
                            district: "Labuhan Badas",
                            description: "Pembangkit, Transmisi, Distribusi dan Penjualan Tenaga Listrik"
                        },
                        {
                            name: "SUMBER REJEKI POWER",
                            investment: 207753285189,
                            type: "PMDN",
                            kbli: "35111",
                            district: "Unter Iwes",
                            description: "Pembangkitan Tenaga Listrik"
                        },
                        {
                            name: "SUMBAWA JUTARAYA",
                            investment: 185480600525,
                            type: "PMDN",
                            kbli: "07301",
                            district: "Ropang",
                            description: "Pertambangan Emas Dan Perak"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "CHAROEN POKPHAND INDONESIA",
                            investment: 434477903300,
                            type: "PMDN",
                            kbli: "52101",
                            district: "Moyo Hilir",
                            description: "Pergudangan dan Penyimpanan"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "SUMBAWA JUTARAYA",
                            investment: 271595378206,
                            type: "PMDN",
                            kbli: "24201",
                            district: "Ropang",
                            description: "Industri Pembuatan Logam Dasar Mulia"
                        }
                    ]
                }
            },
            "Sumbawa Barat": {
                name: "Sumbawa Barat",
                type: "Kabupaten",
                population: "135,689",
                totalInvestment: 287498166628133,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "AMMAN MINERAL NUSA TENGGARA",
                            investment: 234990859636484,
                            type: "PMDN",
                            kbli: "07294",
                            district: "Sekongkang",
                            description: "Pertambangan Bijih Tembaga"
                        },
                        {
                            name: "MACMAHON INDONESIA",
                            investment: 17239364616487,
                            type: "PMA",
                            kbli: "09900",
                            district: "Sekongkang",
                            description: "Aktivitas Penunjang pertambangan dan penggalian lainnya"
                        },
                        {
                            name: "AMMAN MINERAL NUSA TENGGARA",
                            investment: 15775802514269,
                            type: "PMDN",
                            kbli: "07294",
                            district: "Sekongkang",
                            description: "Pertambangan Bijih Tembaga"
                        },
                        {
                            name: "JURONG ENGINEERING LESTARI",
                            investment: 2105964077594,
                            type: "PMA",
                            kbli: "43211",
                            district: "Maluk",
                            description: "Instalasi Listrik"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "AMMAN MINERAL INDUSTRI",
                            investment: 17386161163299,
                            type: "PMDN",
                            kbli: "24202",
                            district: "Maluk",
                            description: "Industri Pembuatan Logam Dasar Bukan Besi"
                        }
                    ]
                }
            },
            "Dompu": {
                name: "Dompu",
                type: "Kabupaten",
                population: "230,696",
                totalInvestment: 7984768655151,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "SUMBAWA TIMUR MINING",
                            investment: 7802569572664,
                            type: "PMA",
                            kbli: "07301",
                            district: "Hu'u",
                            description: "Pertambangan Emas Dan Perak"
                        },
                        {
                            name: "MACMAHON MINING SERVICES",
                            investment: 27695888493,
                            type: "PMA",
                            kbli: "09900",
                            district: "Hu'u",
                            description: "Aktivitas Penunjang pertambangan dan penggalian lainnya"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "SEGER AGRO NUSANTARA",
                            investment: 69588510000,
                            type: "PMDN",
                            kbli: "46201",
                            district: "Pekat",
                            description: "Perdagangan Besar Padi Dan Palawija"
                        }
                    ],
                    "Pertanian": [
                        {
                            name: "SUKSES MANTAP SEJAHTERA",
                            investment: 47391075499,
                            type: "PMDN",
                            kbli: "01140",
                            district: "Pekat",
                            description: "Perkebunan Tebu"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "SUKSES MANTAP SEJAHTERA",
                            investment: 37523608495,
                            type: "PMDN",
                            kbli: "10721",
                            district: "Pekat",
                            description: "Industri Gula Pasir"
                        }
                    ]
                }
            },
            "Bima": {
                name: "Bima",
                type: "Kabupaten",
                population: "440,232",
                totalInvestment: 916465202413,
                totalCompanies: 5,
                sectors: {
                    "Pariwisata dan Ekonomi Kreatif": [
                        {
                            name: "TENGGARA POINT RESORT",
                            investment: 382652766534,
                            type: "PMA",
                            kbli: "55194",
                            district: "Parado",
                            description: "Vila"
                        },
                        {
                            name: "GOLDEN PALM SURYATAMA",
                            investment: 190382025581,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Sape",
                            description: "Hotel Bintang"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "CHAROEN POKPHAND INDONESIA",
                            investment: 198867748959,
                            type: "PMDN",
                            kbli: "52101",
                            district: "Madapangga",
                            description: "Pergudangan dan Penyimpanan"
                        }
                    ],
                    "Kelautan dan Perikanan": [
                        {
                            name: "TIRTAMAS MUTIARA",
                            investment: 89000197224,
                            type: "PMDN",
                            kbli: "03219",
                            district: "Langgudu",
                            description: "Budidaya Biota Air Laut Lainnya"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "SANGGARAGRO KARYAPERSADA",
                            investment: 55563464705,
                            type: "PMDN",
                            kbli: "20294",
                            district: "Tambora",
                            description: "Industri Minyak Atsiri"
                        }
                    ]
                }
            },
            "Kota Bima": {
                name: "Kota Bima",
                type: "Kota",
                population: "149,859",
                totalInvestment: 197901240959,
                totalCompanies: 3,
                sectors: {
                    "Transportasi": [
                        {
                            name: "PERUSAHAAN GAS NEGARA",
                            investment: 146299999999,
                            type: "PMDN",
                            kbli: "49300",
                            district: "Asakota",
                            description: "Angkutan Melalui Saluran Pipa"
                        }
                    ],
                    "Kesehatan": [
                        {
                            name: "RS PKU MUHAMMADIYAH BIMA",
                            investment: 33415106982,
                            type: "PMDN",
                            kbli: "86103",
                            district: "Mpunda",
                            description: "Aktivitas Rumah Sakit Swasta"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "SAKA AGUNG ABADI",
                            investment: 18186133978,
                            type: "PMDN",
                            kbli: "46634",
                            district: "Rasanae Barat",
                            description: "Perdagangan Besar Semen, Kapur, Pasir Dan Batu"
                        }
                    ]
                }
            }
        };

        // 16 Sektor yang diminta
        const allSectors = [
            { name: "Perindustrian", icon: "fa-industry" },
            { name: "ESDM", icon: "fa-bolt" },
            { name: "Lingkungan Hidup", icon: "fa-leaf" },
            { name: "Perdagangan", icon: "fa-store" },
            { name: "Pariwisata dan Ekonomi Kreatif", icon: "fa-camera" },
            { name: "Transportasi", icon: "fa-truck" },
            { name: "Komunikasi", icon: "fa-tower-cell" },
            { name: "Keuangan", icon: "fa-coins" },
            { name: "Pertanian dan Kehutanan", icon: "fa-seedling" },
            { name: "Kelautan dan Perikanan", icon: "fa-fish" },
            { name: "PUPR", icon: "fa-building" },
            { name: "Pendidikan", icon: "fa-graduation-cap" },
            { name: "Kesehatan", icon: "fa-hospital" },
            { name: "Peternakan", icon: "fa-cow" },
            { name: "Telekomunikasi", icon: "fa-satellite-dish" },
            { name: "Pertanian", icon: "fa-wheat-awn" }
        ];

        // Coordinates for NTB regions
        const regionCoordinates = {
            "Mataram": [116.1178, -8.5833],
            "Lombok Barat": [116.1047, -8.6500],
            "Lombok Tengah": [116.3081, -8.7000],
            "Lombok Timur": [116.5472, -8.5500],
            "Lombok Utara": [116.4067, -8.3500],
            "Sumbawa": [117.4181, -8.4667],
            "Sumbawa Barat": [116.8167, -8.7167],
            "Dompu": [118.4667, -8.5333],
            "Bima": [118.7167, -8.4667],
            "Kota Bima": [118.7267, -8.4600]
        };

        let currentSlide = 0;
        let totalSlides = 0;
        let presentationMap = null;
        let markersLayer = null;
        const regions = Object.keys(investmentData);

        function formatCurrency(value) {
            const numValue = parseInt(value);
            if (isNaN(numValue)) return 'Rp 0';
            
            if (numValue >= 1000000000000000) {
                return `Rp ${(numValue / 1000000000000000).toFixed(1)} Kuadriliun`;
            } else if (numValue >= 1000000000000) {
                return `Rp ${(numValue / 1000000000000).toFixed(1)} Triliun`;
            } else if (numValue >= 1000000000) {
                return `Rp ${(numValue / 1000000000).toFixed(1)} Miliar`;
            } else if (numValue >= 1000000) {
                return `Rp ${(numValue / 1000000).toFixed(1)} Juta`;
            }
            return `Rp ${numValue.toLocaleString('id-ID')}`;
        }

        function initializePresentation() {
            populateRegionList();
            createRegionSlides();
            initializeMap();
            updateMapStats();
            updateProgress();
            updateNavigationButtons();
        }

        function initializeMap() {
            // Check if map container exists
            const mapContainer = document.getElementById('presentationMap');
            if (!mapContainer) {
                console.error('Map container not found');
                return;
            }

            try {
                // Initialize map centered on NTB
                presentationMap = L.map('presentationMap', {
                    zoomControl: false,
                    minZoom: 7,
                    maxZoom: 12
                }).setView([-8.6500, 117.3616], 8);

                // Add tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '© OpenStreetMap contributors | Data: DPMPTSP NTB'
                }).addTo(presentationMap);

                // Add zoom control to bottom right
                L.control.zoom({
                    position: 'bottomright'
                }).addTo(presentationMap);

                // Create markers layer
                markersLayer = L.layerGroup().addTo(presentationMap);

                // Add markers for each region
                addRegionMarkers();
            } catch (error) {
                console.error('Error initializing map:', error);
            }
        }

        function addRegionMarkers() {
            if (!markersLayer) {
                console.error('Markers layer not initialized');
                return;
            }

            regions.forEach(regionKey => {
                const region = investmentData[regionKey];
                const coords = regionCoordinates[regionKey];
                
                if (!coords || !region) {
                    console.warn(`Missing data for region: ${regionKey}`);
                    return;
                }

                try {
                    // Calculate marker size based on investment
                    const investmentValue = region.totalInvestment;
                    let markerSize = 15;
                    if (investmentValue > 100000000000000) markerSize = 25;
                    else if (investmentValue > 10000000000000) markerSize = 22;
                    else if (investmentValue > 1000000000000) markerSize = 20;
                    else if (investmentValue > 100000000000) markerSize = 18;

                    // Determine marker style based on region type
                    let markerColor, markerIcon;
                    if (region.type === 'Ibu Kota') {
                        markerColor = 'linear-gradient(135deg, #f093fb, #f5576c)';
                        markerIcon = 'fa-star';
                    } else if (region.type === 'Kota') {
                        markerColor = 'linear-gradient(135deg, #4facfe, #00f2fe)';
                        markerIcon = 'fa-building';
                    } else {
                        markerColor = 'linear-gradient(135deg, #667eea, #764ba2)';
                        markerIcon = 'fa-mountain';
                    }

                    // Create custom marker
                    const customIcon = L.divIcon({
                        html: `
                            <div style="
                                width: ${markerSize * 2}px;
                                height: ${markerSize * 2}px;
                                background: ${markerColor};
                                border: 3px solid white;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: ${markerSize * 0.6}px;
                                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                                cursor: pointer;
                                transition: all 0.3s ease;
                                animation: markerPulse 2s infinite;
                            ">
                                <i class="fas ${markerIcon}"></i>
                            </div>
                        `,
                        className: 'custom-map-marker',
                        iconSize: [markerSize * 2, markerSize * 2],
                        iconAnchor: [markerSize, markerSize]
                    });

                    // Create marker
                    const marker = L.marker([coords[1], coords[0]], { icon: customIcon });

                    // Create popup content
                    const popupContent = createMapPopupContent(region, regionKey);
                    
                    marker.bindPopup(popupContent, {
                        maxWidth: 300,
                        className: 'custom-map-popup',
                        closeButton: true,
                        autoClose: false,
                        autoPan: true,
                        keepInView: true
                    });

                    // Add hover effects for tooltip only
                    marker.on('mouseover', function() {
                        if (!this.isPopupOpen()) {
                            this.openTooltip();
                        }
                    });

                    marker.on('mouseout', function() {
                        this.closeTooltip();
                    });

                    // Add click handler to open popup
                    marker.on('click', function(e) {
                        // Close all other popups first
                        presentationMap.eachLayer(function(layer) {
                            if (layer !== marker && layer.closePopup) {
                                layer.closePopup();
                            }
                        });
                        
                        // Open this popup
                        this.openPopup();
                        
                        // Prevent event bubbling
                        L.DomEvent.stopPropagation(e);
                    });

                    // Add tooltip
                    marker.bindTooltip(`
                        <div style="text-align: center; font-weight: 600;">
                            <div>${region.name}</div>
                            <div style="font-size: 10px; opacity: 0.8;">${formatCurrency(region.totalInvestment)}</div>
                        </div>
                    `, {
                        permanent: false,
                        direction: 'top',
                        className: 'custom-map-tooltip',
                        offset: [0, -10]
                    });

                    markersLayer.addLayer(marker);
                } catch (error) {
                    console.error(`Error creating marker for ${regionKey}:`, error);
                }
            });
        }

        function createMapPopupContent(region, regionKey) {
            const activeSectors = Object.keys(region.sectors).length;
            
            return `
                <div class="map-popup">
                    <div class="popup-header">
                        <div class="popup-region-name">${region.name}</div>
                        <div class="popup-region-type">${region.type}</div>
                    </div>
                    <div class="popup-body">
                        <div class="popup-stats">
                            <div class="popup-stat">
                                <div class="popup-stat-value">${region.totalCompanies}</div>
                                <div class="popup-stat-label">Perusahaan</div>
                            </div>
                            <div class="popup-stat">
                                <div class="popup-stat-value">${activeSectors}</div>
                                <div class="popup-stat-label">Sektor Aktif</div>
                            </div>
                        </div>
                        <div style="text-align: center; margin: 10px 0;">
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--primary-green);">
                                ${formatCurrency(region.totalInvestment)}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">
                                Total Investasi
                            </div>
                        </div>
                        <div class="popup-actions">
                            <button class="popup-btn primary" onclick="goToRegionDetail('${regionKey}'); event.stopPropagation();">
                                <i class="fas fa-chart-bar"></i> Detail
                            </button>
                            <button class="popup-btn secondary" onclick="closeMapPopups(); event.stopPropagation();">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateMapStats() {
            try {
                const totalCompanies = regions.reduce((sum, regionKey) => 
                    sum + (investmentData[regionKey]?.totalCompanies || 0), 0);
                const totalInvestment = regions.reduce((sum, regionKey) => 
                    sum + (investmentData[regionKey]?.totalInvestment || 0), 0);

                const mapTotalCompanies = document.getElementById('mapTotalCompanies');
                const mapTotalInvestment = document.getElementById('mapTotalInvestment');
                
                if (mapTotalCompanies) mapTotalCompanies.textContent = totalCompanies;
                if (mapTotalInvestment) mapTotalInvestment.textContent = formatCurrency(totalInvestment);
            } catch (error) {
                console.error('Error updating map stats:', error);
            }
        }

        function showMapOverview() {
            showRegionSlide('map');
            
            // Refresh map size after showing
            setTimeout(() => {
                if (presentationMap) {
                    try {
                        presentationMap.invalidateSize();
                        presentationMap.setView([-8.6500, 117.3616], 8);
                    } catch (error) {
                        console.error('Error refreshing map:', error);
                    }
                }
            }, 300);
        }

        function resetMapView() {
            if (presentationMap) {
                try {
                    presentationMap.setView([-8.6500, 117.3616], 8);
                    closeMapPopups();
                } catch (error) {
                    console.error('Error resetting map view:', error);
                }
            }
        }

        function toggleMapFullscreen() {
            const mapContainer = document.querySelector('.map-container');
            if (mapContainer && mapContainer.requestFullscreen) {
                mapContainer.requestFullscreen();
                setTimeout(() => {
                    if (presentationMap) {
                        try {
                            presentationMap.invalidateSize();
                        } catch (error) {
                            console.error('Error invalidating map size:', error);
                        }
                    }
                }, 100);
            }
        }

        function goToRegionDetail(regionKey) {
            const slideIndex = regions.indexOf(regionKey) + 2; // +2 for welcome and map slides
            if (slideIndex >= 2) {
                showRegionSlide(slideIndex);
                updateActiveRegion(regionKey);
                closeMapPopups();
            }
        }

        function closeMapPopups() {
            if (presentationMap) {
                try {
                    presentationMap.closePopup();
                    presentationMap.eachLayer(function(layer) {
                        if (layer.closePopup) {
                            layer.closePopup();
                        }
                        if (layer.closeTooltip) {
                            layer.closeTooltip();
                        }
                    });
                } catch (error) {
                    console.error('Error closing map popups:', error);
                }
            }
        }

        function populateRegionList() {
            const regionList = document.getElementById('regionList');
            regionList.innerHTML = '';

            regions.forEach((regionKey, index) => {
                const region = investmentData[regionKey];
                const regionItem = document.createElement('div');
                regionItem.className = 'region-item';
                regionItem.setAttribute('data-region', regionKey);
                regionItem.setAttribute('data-slide', index + 2); // +2 for welcome and map slides
                regionItem.setAttribute('data-search', region.name.toLowerCase()); // For search functionality
                
                regionItem.innerHTML = `
                    <div class="region-name">${region.name}</div>
                    <div class="region-stats">
                        <span>${region.totalCompanies} Perusahaan</span>
                        <span class="region-investment">${formatCurrency(region.totalInvestment)}</span>
                    </div>
                `;
                
                regionItem.addEventListener('click', () => {
                    showRegionSlide(index + 2); // +2 for welcome and map slides
                    updateActiveRegion(regionKey);
                });
                
                regionList.appendChild(regionItem);
            });
            
            totalSlides = regions.length + 2; // +2 for welcome and map slides
            
            // Initialize search functionality
            initializeSearch();
        }

        function initializeSearch() {
            const searchInput = document.getElementById('regionSearch');
            const searchClear = document.getElementById('searchClear');
            
            if (!searchInput || !searchClear) return;
            
            searchInput.addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase().trim();
                
                if (query.length > 0) {
                    searchClear.classList.add('show');
                    filterRegions(query);
                } else {
                    searchClear.classList.remove('show');
                    showAllRegions();
                }
            });
            
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    clearSearch();
                }
            });
        }

        function filterRegions(query) {
            const regionItems = document.querySelectorAll('.region-item');
            const noResults = document.getElementById('noResults');
            let visibleCount = 0;
            
            regionItems.forEach(item => {
                const searchText = item.getAttribute('data-search');
                const regionName = item.querySelector('.region-name').textContent.toLowerCase();
                
                if (searchText.includes(query) || regionName.includes(query)) {
                    item.classList.remove('hidden');
                    visibleCount++;
                } else {
                    item.classList.add('hidden');
                }
            });
            
            if (visibleCount === 0) {
                noResults.classList.add('show');
            } else {
                noResults.classList.remove('show');
            }
        }

        function showAllRegions() {
            const regionItems = document.querySelectorAll('.region-item');
            const noResults = document.getElementById('noResults');
            
            regionItems.forEach(item => {
                item.classList.remove('hidden');
            });
            
            noResults.classList.remove('show');
        }

        function clearSearch() {
            const searchInput = document.getElementById('regionSearch');
            const searchClear = document.getElementById('searchClear');
            
            if (searchInput) {
                searchInput.value = '';
                searchInput.focus();
            }
            
            if (searchClear) {
                searchClear.classList.remove('show');
            }
            
            showAllRegions();
        }

        function toggleSectorFilter(regionKey, slideIndex) {
            const toggle = document.getElementById(`toggleSector-${slideIndex}`);
            const grid = document.getElementById(`sectorsGrid-${slideIndex}`);
            const countInfo = document.getElementById(`sectorCount-${slideIndex}`);
            
            if (!toggle || !grid || !countInfo) return;
            
            const isActive = toggle.classList.contains('active');
            const region = investmentData[regionKey];
            const activeSectors = Object.keys(region.sectors).length;
            
            if (isActive) {
                // Show all sectors
                toggle.classList.remove('active');
                toggle.querySelector('span').textContent = 'Hanya Sektor Aktif';
                
                const cards = grid.querySelectorAll('.sector-card');
                cards.forEach(card => {
                    card.style.display = 'flex';
                });
                
                countInfo.textContent = `Menampilkan ${allSectors.length} dari ${allSectors.length} sektor`;
            } else {
                // Show only active sectors
                toggle.classList.add('active');
                toggle.querySelector('span').textContent = 'Semua Sektor';
                
                const cards = grid.querySelectorAll('.sector-card');
                cards.forEach(card => {
                    const hasData = card.getAttribute('data-has-data') === 'true';
                    card.style.display = hasData ? 'flex' : 'none';
                });
                
                countInfo.textContent = `Menampilkan ${activeSectors} dari ${allSectors.length} sektor`;
            }
        }

        function createRegionSlides() {
            const slideContent = document.querySelector('.slide-content');
            
            regions.forEach((regionKey, index) => {
                const region = investmentData[regionKey];
                const slide = document.createElement('div');
                slide.className = 'slide';
                slide.id = `slide-${index + 1}`;
                
                // Get sectors for this region
                const regionSectors = Object.keys(region.sectors);
                
                // Create sector cards with data from the region
                const sectorCards = allSectors.map(sector => {
                    const hasData = regionSectors.includes(sector.name);
                    const sectorData = hasData ? region.sectors[sector.name] : [];
                    const totalInvestment = sectorData.reduce((sum, investor) => sum + investor.investment, 0);
                    
                    return `
                        <div class="sector-card ${hasData ? '' : 'no-data'}" 
                             data-has-data="${hasData}"
                             onclick="${hasData ? `showSectorDetail('${sector.name}', '${regionKey}')` : ''}">
                            <div class="sector-header">
                                <div class="sector-icon">
                                    <i class="fas ${sector.icon}"></i>
                                </div>
                                <div class="sector-info">
                                    <h3>${sector.name}</h3>
                                    <div class="sector-count">
                                        ${hasData ? `${sectorData.length} Investor` : 'Tidak ada data'}
                                    </div>
                                </div>
                            </div>
                            <div class="sector-stats">
                                <div class="sector-investment">
                                    ${hasData ? formatCurrency(totalInvestment) : '-'}
                                </div>
                                <div class="sector-arrow">
                                    <i class="fas fa-chevron-right"></i>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                slide.innerHTML = `
                    <div class="region-detail-header">
                        <div class="region-detail-title">
                            <div class="region-icon">
                                <i class="fas ${region.type === 'Ibu Kota' ? 'fa-star' : region.type === 'Kota' ? 'fa-building' : 'fa-mountain'}"></i>
                            </div>
                            <div class="region-title-text">
                                <h2>${region.name}</h2>
                                <p>${region.type} • Populasi: ${region.population} jiwa</p>
                            </div>
                        </div>
                        <div class="region-stats-summary">
                            <div class="stat-item">
                                <div class="stat-value">${region.totalCompanies}</div>
                                <div class="stat-label">Perusahaan</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${Object.keys(region.sectors).length}</div>
                                <div class="stat-label">Sektor Aktif</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${formatCurrency(region.totalInvestment)}</div>
                                <div class="stat-label">Total Investasi</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sector-controls">
                        <button class="sector-toggle" id="toggleSector-${index}" onclick="toggleSectorFilter('${regionKey}', ${index})">
                            <i class="fas fa-filter"></i>
                            <span>Hanya Sektor Aktif</span>
                        </button>
                        <div class="sector-count-info" id="sectorCount-${index}">
                            Menampilkan ${allSectors.length} dari ${allSectors.length} sektor
                        </div>
                    </div>
                    
                    <div class="sectors-grid" id="sectorsGrid-${index}">
                        ${sectorCards}
                    </div>
                `;
                
                slideContent.appendChild(slide);
            });
        }

        function showSectorDetail(sectorName, regionKey) {
            const region = investmentData[regionKey];
            const sectorData = region.sectors[sectorName] || [];
            
            if (sectorData.length === 0) return;
            
            // Sort by investment amount
            const sortedInvestors = [...sectorData].sort((a, b) => b.investment - a.investment);
            
            const modal = document.getElementById('sectorModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            const sectorIcon = allSectors.find(s => s.name === sectorName)?.icon || 'fa-chart-line';
            
            modalTitle.innerHTML = `
                <i class="fas ${sectorIcon}"></i>
                <span>${sectorName} - ${region.name}</span>
            `;
            
            const investorCards = sortedInvestors.map((investor, index) => {
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                
                return `
                    <div class="investor-card">
                        <div class="investor-rank">
                            <div class="rank-number ${rankClass}">${index + 1}</div>
                            <div class="investor-name">${investor.name}</div>
                            <div class="investor-type ${investor.type}">${investor.type}</div>
                        </div>
                        <div class="investor-details">
                            <div class="detail-item">
                                <i class="fas fa-map-marker-alt detail-icon"></i>
                                <span>${investor.district}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-code detail-icon"></i>
                                <span>KBLI: ${investor.kbli}</span>
                            </div>
                        </div>
                        <div class="investor-investment">${formatCurrency(investor.investment)}</div>
                        <div style="margin-top: 10px; padding: 10px; background: var(--light-bg); border-radius: 8px; font-size: 0.85rem; color: var(--text-light);">
                            ${investor.description}
                        </div>
                    </div>
                `;
            }).join('');
            
            modalBody.innerHTML = `
                <div class="top-investors-grid">
                    ${investorCards}
                </div>
            `;
            
            modal.classList.add('active');
        }

        function closeSectorModal() {
            document.getElementById('sectorModal').classList.remove('active');
        }

        function showRegionSlide(slideNumber) {
            // Hide all slides
            document.querySelectorAll('.slide').forEach(slide => {
                slide.classList.remove('active');
            });
            
            // Show target slide
            if (slideNumber === 0) {
                document.getElementById('welcomeSlide').classList.add('active');
                currentSlide = 0;
            } else if (slideNumber === 'map' || slideNumber === 1) {
                document.getElementById('mapOverviewSlide').classList.add('active');
                currentSlide = 1;
                // Refresh map after showing
                setTimeout(() => {
                    if (presentationMap) {
                        presentationMap.invalidateSize();
                    }
                }, 100);
            } else {
                const regionSlideIndex = slideNumber - 2; // Adjust for welcome and map slides
                const targetSlide = document.getElementById(`slide-${regionSlideIndex + 1}`);
                if (targetSlide) {
                    targetSlide.classList.add('active');
                }
                currentSlide = slideNumber;
            }
            
            updateProgress();
            updateNavigationButtons();
            updateMapNavButton();
        }

        function updateMapNavButton() {
            const mapNavButton = document.getElementById('mapNavButton');
            if (currentSlide === 1) { // Map slide
                mapNavButton.style.display = 'none';
            } else {
                mapNavButton.style.display = 'flex';
            }
        }
        

        function updateActiveRegion(regionKey) {
            document.querySelectorAll('.region-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeItem = document.querySelector(`[data-region="${regionKey}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                const nextSlideNumber = currentSlide + 1;
                showRegionSlide(nextSlideNumber);
                
                if (nextSlideNumber > 1) { // Region slides start from index 2
                    const regionKey = regions[nextSlideNumber - 2];
                    updateActiveRegion(regionKey);
                } else {
                    document.querySelectorAll('.region-item').forEach(item => {
                        item.classList.remove('active');
                    });
                }
            }
        }

        function previousSlide() {
            if (currentSlide > 0) {
                const prevSlideNumber = currentSlide - 1;
                showRegionSlide(prevSlideNumber);
                
                if (prevSlideNumber > 1) { // Region slides start from index 2
                    const regionKey = regions[prevSlideNumber - 2];
                    updateActiveRegion(regionKey);
                } else {
                    document.querySelectorAll('.region-item').forEach(item => {
                        item.classList.remove('active');
                    });
                }
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentSlide === 0;
            nextBtn.disabled = currentSlide === totalSlides - 1;
        }

        function updateProgress() {
            const progressBar = document.getElementById('progressBar');
            const progress = (currentSlide / (totalSlides - 1)) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function resetPresentation() {
            showRegionSlide(0);
            document.querySelectorAll('.region-item').forEach(item => {
                item.classList.remove('active');
            });
            closeSectorModal();
            closeMapPopups();
            clearSearch(); // Clear search when resetting
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Add marker pulse animation and custom styles
        const markerStyle = document.createElement('style');
        markerStyle.textContent = `
            @keyframes markerPulse {
                0% { box-shadow: 0 4px 12px rgba(0,0,0,0.3), 0 0 0 0 rgba(102, 126, 234, 0.7); }
                70% { box-shadow: 0 4px 12px rgba(0,0,0,0.3), 0 0 0 10px rgba(102, 126, 234, 0); }
                100% { box-shadow: 0 4px 12px rgba(0,0,0,0.3), 0 0 0 0 rgba(102, 126, 234, 0); }
            }
            
            .custom-map-marker:hover {
                transform: scale(1.2) !important;
                z-index: 1000 !important;
            }
            
            .custom-map-tooltip {
                background: rgba(255, 255, 255, 0.95) !important;
                border: none !important;
                border-radius: 8px !important;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
                padding: 8px 12px !important;
                font-size: 12px !important;
                color: #333 !important;
            }
            
            .leaflet-tooltip-top:before {
                border-top-color: rgba(255, 255, 255, 0.95) !important;
            }
            
            /* Custom popup styles */
            .leaflet-popup {
                z-index: 1002 !important;
            }
            
            .leaflet-popup-pane {
                z-index: 1002 !important;
            }
            
            .popup-btn {
                cursor: pointer !important;
                border: none !important;
                outline: none !important;
                user-select: none !important;
            }
        `;
        document.head.appendChild(markerStyle);

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            // Don't interfere with search input
            if (e.target.id === 'regionSearch') {
                return;
            }
            
            switch(e.key) {
                case 'ArrowRight':
                case ' ':
                    e.preventDefault();
                    nextSlide();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    previousSlide();
                    break;
                case 'Home':
                    e.preventDefault();
                    resetPresentation();
                    break;
                case 'Escape':
                    closeSectorModal();
                    closeMapPopups();
                    break;
                case 'F11':
                    e.preventDefault();
                    toggleFullscreen();
                    break;
                case 'M':
                case 'm':
                    e.preventDefault();
                    showMapOverview();
                    break;
                case '/':
                    e.preventDefault();
                    document.getElementById('regionSearch')?.focus();
                    break;
            }
        });

        // Handle window resize for map
        window.addEventListener('resize', () => {
            if (presentationMap) {
                setTimeout(() => {
                    try {
                        presentationMap.invalidateSize();
                    } catch (error) {
                        console.error('Error handling resize:', error);
                    }
                }, 100);
            }
        });

        // Close modal when clicking outside or handle popup interactions
        document.getElementById('sectorModal').addEventListener('click', (e) => {
            if (e.target.id === 'sectorModal') {
                closeSectorModal();
            }
        });

        // Add global click handler for popup buttons
        document.addEventListener('click', function(e) {
            if (e.target.closest('.popup-btn')) {
                const btn = e.target.closest('.popup-btn');
                if (btn.onclick) {
                    btn.onclick();
                }
            }
        });

        // Prevent map clicks when popup is open
        document.addEventListener('click', function(e) {
            if (e.target.closest('.leaflet-popup')) {
                e.stopPropagation();
            }
        });

        // Initialize presentation when page loads
        document.addEventListener('DOMContentLoaded', function() {
            try {
                initializePresentation();
                console.log('Presentation initialized successfully');
            } catch (error) {
                console.error('Error initializing presentation:', error);
                // Fallback initialization without map
                populateRegionList();
                createRegionSlides();
                updateProgress();
                updateNavigationButtons();
            }
        });
    </script>
</body>
</html>