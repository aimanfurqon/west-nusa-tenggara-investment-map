<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Investasi NTB - Presentasi Interaktif</title>
    <meta name="description" content="Dashboard interaktif investasi Nusa Tenggara Barat dengan detail 10 kabupaten/kota dan 16 sektor ekonomi">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary-blue: #2563eb;
            --primary-green: #059669;
            --accent-gold: #f59e0b;
            --dark-blue: #1e3a8a;
            --light-bg: #f8fafc;
            --white: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --border-light: #e5e7eb;
            --hover-bg: #f3f4f6;
            --error-red: #dc2626;
            --success-green: #16a34a;
            --warning-yellow: #ca8a04;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow: hidden;
        }

        /* Skip to content for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-blue);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 10000;
            transition: top 0.3s;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* Loading States */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-light);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-dark);
            font-weight: 500;
            margin-bottom: 10px;
        }

        .loading-subtext {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Error States */
        .error-state {
            display: none;
            text-align: center;
            padding: 40px 20px;
            color: var(--error-red);
        }

        .error-state.show {
            display: block;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .error-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .error-message {
            color: var(--text-light);
            margin-bottom: 20px;
        }

        .retry-btn {
            padding: 10px 20px;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .retry-btn:hover {
            background: var(--dark-blue);
            transform: translateY(-1px);
        }

        .presentation-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Enhanced Header */
        .presentation-header {
            background: var(--white);
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            min-height: 80px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 0;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .logo {
            height: 45px;
            width: auto;
            max-width: 120px;
        }

        .title-section {
            min-width: 0;
            flex: 1;
        }

        .title-section h1 {
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            font-weight: 800;
            color: var(--primary-blue);
            margin-bottom: 3px;
            line-height: 1.2;
        }

        .title-section p {
            color: var(--text-light);
            font-size: clamp(0.75rem, 2vw, 0.9rem);
            font-weight: 500;
            line-height: 1.3;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .presentation-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 8px 12px;
            border: 2px solid var(--primary-blue);
            background: var(--white);
            color: var(--primary-blue);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .control-btn:hover, 
        .control-btn.active,
        .control-btn:focus {
            background: var(--primary-blue);
            color: var(--white);
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        .control-btn:focus-visible {
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        /* Main Content Area */
        .content-area {
            flex: 1;
            display: flex;
            background: var(--white);
            position: relative;
            min-height: 0;
        }

        /* Enhanced Slide Navigation */
        .slide-navigation {
            width: 280px;
            background: var(--light-bg);
            border-right: 1px solid var(--border-light);
            overflow-y: auto;
            padding: 20px 15px;
            flex-shrink: 0;
        }

        .nav-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Enhanced Search */
        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 2px solid var(--border-light);
            border-radius: 10px;
            font-size: 0.9rem;
            background: var(--white);
            transition: all 0.3s ease;
            outline: none;
        }

        .search-input:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-size: 0.9rem;
            pointer-events: none;
        }

        .search-clear {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            display: none;
        }

        .search-clear:hover,
        .search-clear:focus {
            background: var(--hover-bg);
            color: var(--text-dark);
            outline: 2px solid var(--primary-blue);
        }

        .search-clear.show {
            display: block;
        }

        .region-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: calc(100vh - 280px);
            overflow-y: auto;
            padding-right: 5px;
        }

        .region-list::-webkit-scrollbar {
            width: 6px;
        }

        .region-list::-webkit-scrollbar-track {
            background: var(--border-light);
            border-radius: 3px;
        }

        .region-list::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 3px;
        }

        .region-list::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }

        .region-item {
            padding: 12px;
            background: var(--white);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
        }

        .region-item:hover {
            border-color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15);
        }

        .region-item:focus {
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        .region-item.active {
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%);
        }

        .region-name {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
            font-size: 0.95rem;
            line-height: 1.3;
        }

        .region-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-light);
            gap: 10px;
        }

        .region-investment {
            font-weight: 600;
            color: var(--primary-green);
        }

        .region-item.hidden {
            display: none;
        }

        .no-results {
            text-align: center;
            padding: 30px 15px;
            color: var(--text-light);
            display: none;
        }

        .no-results.show {
            display: block;
        }

        .no-results i {
            font-size: 2rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Enhanced Main Slide Area */
        .slide-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            position: relative;
            min-width: 0;
        }

        .slide {
            display: none;
            animation: slideIn 0.5s ease-in-out;
            min-height: 100%;
        }

        .slide.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Enhanced Welcome Slide */
        .welcome-slide {
            text-align: center;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            min-height: 500px;
        }

        .welcome-icon {
            font-size: clamp(3rem, 8vw, 4rem);
            color: var(--primary-blue);
            margin-bottom: 25px;
        }

        .welcome-title {
            font-size: clamp(1.8rem, 6vw, 2.5rem);
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .welcome-subtitle {
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: var(--text-light);
            margin-bottom: 30px;
            max-width: 600px;
            line-height: 1.6;
        }

        .welcome-instructions {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--primary-blue);
            max-width: 500px;
            text-align: left;
            width: 100%;
        }

        .welcome-instructions h3 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .welcome-instructions p {
            color: var(--text-light);
            line-height: 1.5;
            font-size: 0.9rem;
        }

        /* Enhanced Region Detail */
        .region-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--border-light);
            flex-wrap: wrap;
            gap: 20px;
        }

        .region-detail-title {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 250px;
        }

        .region-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .region-title-text h2 {
            font-size: clamp(1.3rem, 4vw, 1.8rem);
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .region-title-text p {
            color: var(--text-light);
            font-size: clamp(0.8rem, 2vw, 0.95rem);
        }

        .region-stats-summary {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .stat-item {
            padding: 10px 12px;
            background: var(--light-bg);
            border-radius: 10px;
            border-bottom: 3px solid var(--primary-blue);
            text-align: center;
            min-width: 80px;
        }

        .stat-value {
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-weight: 700;
            color: var(--primary-blue);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-light);
            font-weight: 500;
            margin-top: 2px;
        }

        /* Enhanced Sector Controls */
        .sector-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--light-bg);
            border-radius: 10px;
        }

        .sector-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--white);
            border-radius: 8px;
            border: 2px solid var(--border-light);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .sector-toggle:hover,
        .sector-toggle:focus {
            background: var(--border-light);
            outline: 2px solid var(--primary-blue);
        }

        .sector-toggle.active {
            background: var(--primary-blue);
            color: var(--white);
            border-color: var(--primary-blue);
        }

        .sector-count-info {
            font-size: 0.8rem;
            color: var(--text-light);
            padding: 8px 12px;
            background: var(--white);
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        /* Enhanced Sector Grid */
        .sectors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-height: calc(100vh - 350px);
            overflow-y: auto;
            padding-right: 10px;
        }

        .sectors-grid::-webkit-scrollbar {
            width: 8px;
        }

        .sectors-grid::-webkit-scrollbar-track {
            background: var(--light-bg);
            border-radius: 4px;
        }

        .sectors-grid::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 4px;
        }

        .sectors-grid::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }

        .sector-card {
            background: var(--white);
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .sector-card:focus {
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        .sector-card.no-data {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .sector-card.no-data:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-color: transparent;
        }

        .sector-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-blue), var(--primary-green));
        }

        .sector-card:hover:not(.no-data) {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(37, 99, 235, 0.15);
            border-color: var(--primary-blue);
        }

        .sector-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .sector-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .sector-info {
            flex: 1;
            min-width: 0;
        }

        .sector-info h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .sector-count {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .sector-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .sector-investment {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-green);
        }

        .sector-arrow {
            color: var(--primary-blue);
            font-size: 1.1rem;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .sector-card:hover .sector-arrow {
            opacity: 1;
            transform: translateX(3px);
        }

        /* Enhanced Modal */
        .sector-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .sector-modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            width: 100%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: hidden;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            color: var(--white);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover,
        .modal-close:focus {
            background: rgba(255, 255, 255, 0.2);
            outline: 2px solid white;
        }

        .modal-body {
            padding: 25px;
            max-height: calc(90vh - 100px);
            overflow-y: auto;
        }

        .top-investors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .investor-card {
            background: var(--light-bg);
            border-radius: 12px;
            padding: 18px;
            border-left: 5px solid var(--primary-blue);
            transition: all 0.3s ease;
        }

        .investor-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .investor-rank {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .rank-number {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--accent-gold), #f97316);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .rank-number.gold { background: linear-gradient(135deg, #ffd700, #ffb300); }
        .rank-number.silver { background: linear-gradient(135deg, #c0c0c0, #a8a8a8); }
        .rank-number.bronze { background: linear-gradient(135deg, #cd7f32, #b8860b); }

        .investor-name {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1.3;
            flex: 1;
        }

        .investor-type {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: auto;
            flex-shrink: 0;
        }

        .investor-type.PMA {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .investor-type.PMDN {
            background: #dcfce7;
            color: #166534;
        }

        .investor-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .detail-icon {
            color: var(--primary-blue);
            flex-shrink: 0;
        }

        .investor-investment {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-green);
            text-align: center;
            padding: 10px;
            background: var(--white);
            border-radius: 8px;
            margin-top: 10px;
        }

        /* Enhanced Map Overview */
        .map-overview-slide {
            padding: 15px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
            flex-wrap: wrap;
            gap: 15px;
        }

        .map-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .map-title h2 {
            font-size: clamp(1.3rem, 4vw, 1.6rem);
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
        }

        .map-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .map-control-btn {
            padding: 8px 12px;
            border: 2px solid var(--primary-blue);
            background: var(--white);
            color: var(--primary-blue);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .map-control-btn:hover, 
        .map-control-btn.active,
        .map-control-btn:focus {
            background: var(--primary-blue);
            color: var(--white);
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        .map-container {
            flex: 1;
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            min-height: 400px;
        }

        #presentationMap {
            width: 100%;
            height: 100%;
            min-height: 400px;
        }

        .map-legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 180px;
        }

        .legend-title {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
        }

        .legend-marker {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 8px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .legend-marker.ibu-kota {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .legend-marker.kota {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .legend-marker.kabupaten {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .map-stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 200px;
        }

        .stats-title {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
            font-size: 0.85rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .stats-item {
            text-align: center;
            padding: 6px;
            background: var(--light-bg);
            border-radius: 6px;
        }

        .stats-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .stats-label {
            font-size: 0.65rem;
            color: var(--text-light);
        }

        /* Enhanced Navigation */
        .slide-navigation-bottom {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .nav-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-blue);
            color: var(--white);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .nav-btn:hover,
        .nav-btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
            outline: 2px solid var(--primary-blue);
            outline-offset: 2px;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            height: 4px;
            background: var(--primary-blue);
            transition: width 0.3s ease;
            z-index: 100;
        }

        .map-nav-button {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
            z-index: 1001;
        }

        .map-nav-button:hover,
        .map-nav-button:focus {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
            outline: 2px solid white;
            outline-offset: 2px;
        }

        /* Enhanced No Data State */
        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
        }

        .no-data i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .no-data h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .no-data p {
            font-size: 0.9rem;
        }

        /* Popup Styles */
        .leaflet-popup-content-wrapper {
            border-radius: 12px !important;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
            padding: 0 !important;
        }

        .leaflet-popup-content {
            margin: 0 !important;
            padding: 0 !important;
            min-width: 250px !important;
        }

        .leaflet-popup-close-button {
            top: 10px !important;
            right: 10px !important;
            width: 20px !important;
            height: 20px !important;
            font-size: 16px !important;
            color: white !important;
            background: rgba(0,0,0,0.3) !important;
            border-radius: 50% !important;
            text-align: center !important;
            line-height: 20px !important;
        }

        .leaflet-popup-close-button:hover {
            background: rgba(0,0,0,0.5) !important;
        }

        .map-popup {
            min-width: 250px;
            font-family: 'Inter', sans-serif;
        }

        .popup-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-green));
            color: white;
            padding: 15px;
            text-align: center;
        }

        .popup-region-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .popup-region-type {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .popup-body {
            padding: 15px;
        }

        .popup-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .popup-stat {
            text-align: center;
            padding: 8px;
            background: var(--light-bg);
            border-radius: 6px;
        }

        .popup-stat-value {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .popup-stat-label {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        .popup-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .popup-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .popup-btn.primary {
            background: var(--primary-blue);
            color: white;
        }

        .popup-btn.primary:hover,
        .popup-btn.primary:focus {
            background: var(--dark-blue);
            outline: 2px solid var(--primary-blue);
        }

        .popup-btn.secondary {
            background: var(--light-bg);
            color: var(--text-dark);
        }

        .popup-btn.secondary:hover,
        .popup-btn.secondary:focus {
            background: var(--border-light);
            outline: 2px solid var(--border-light);
        }

        /* Help Modal */
        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .help-modal.active {
            display: flex;
        }

        .help-content {
            background: var(--white);
            border-radius: 15px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .help-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-light);
        }

        .help-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .help-close:hover,
        .help-close:focus {
            background: var(--hover-bg);
            color: var(--text-dark);
            outline: 2px solid var(--primary-blue);
        }

        .help-section {
            margin-bottom: 20px;
        }

        .help-section h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-shortcuts {
            display: grid;
            gap: 8px;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: var(--light-bg);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .shortcut-key {
            background: var(--white);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: 600;
            border: 1px solid var(--border-light);
        }

        /* Enhanced Mobile Responsiveness */
        @media (max-width: 1200px) {
            .presentation-header {
                padding: 12px 15px;
            }
            
            .control-btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .slide-navigation {
                width: 260px;
            }
            
            .sectors-grid {
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            }
        }

        @media (max-width: 1024px) {
            .content-area {
                flex-direction: column;
            }
            
            .slide-navigation {
                width: 100%;
                max-height: 180px;
                order: 2;
                padding: 15px;
            }
            
            .region-list {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 10px;
                max-height: 120px;
            }
            
            .sectors-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
                max-height: calc(100vh - 400px);
            }
            
            .region-detail-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
                gap: 15px;
            }
            
            .region-stats-summary {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .sector-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .map-legend,
            .map-stats {
                position: relative;
                width: 100%;
                margin: 10px 0;
                order: 3;
            }
            
            .map-container {
                order: 2;
            }
        }

        @media (max-width: 768px) {
            .presentation-header {
                padding: 10px 15px;
                flex-direction: column;
                gap: 12px;
                min-height: auto;
            }
            
            .header-left {
                width: 100%;
                justify-content: center;
                text-align: center;
            }
            
            .logo {
                height: 40px;
            }
            
            .header-right {
                width: 100%;
                justify-content: center;
            }
            
            .presentation-controls {
                justify-content: center;
                width: 100%;
            }
            
            .control-btn {
                flex: 1;
                max-width: 120px;
                justify-content: center;
            }
            
            .slide-content {
                padding: 15px;
            }
            
            .slide-navigation {
                padding: 10px;
                max-height: 160px;
            }
            
            .region-list {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 8px;
                max-height: 100px;
            }
            
            .region-item {
                padding: 10px;
            }
            
            .region-name {
                font-size: 0.9rem;
            }
            
            .region-stats {
                flex-direction: column;
                gap: 4px;
                font-size: 0.75rem;
            }
            
            .sectors-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                max-height: calc(100vh - 450px);
            }
            
            .sector-card {
                padding: 15px;
            }
            
            .sector-icon {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .top-investors-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10px;
                max-height: calc(100vh - 20px);
                border-radius: 15px;
            }
            
            .modal-header {
                padding: 15px 20px;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .investor-details {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .welcome-slide {
                padding: 20px 15px;
                min-height: 400px;
            }
            
            .welcome-instructions {
                padding: 15px;
                margin: 0 10px;
            }
            
            .map-header {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .map-controls {
                justify-content: center;
            }
            
            .nav-btn {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
            
            .map-nav-button {
                width: 50px;
                height: 50px;
                bottom: 80px;
                font-size: 1.3rem;
            }
            
            .slide-navigation-bottom {
                bottom: 15px;
                right: 15px;
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            .presentation-header {
                padding: 8px 10px;
            }
            
            .slide-content {
                padding: 10px;
            }
            
            .slide-navigation {
                padding: 8px;
                max-height: 140px;
            }
            
            .region-list {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                max-height: 80px;
            }
            
            .region-item {
                padding: 8px;
            }
            
            .sectors-grid {
                max-height: calc(100vh - 480px);
            }
            
            .control-btn {
                padding: 5px 8px;
                font-size: 0.75rem;
            }
            
            .modal-content {
                margin: 5px;
                border-radius: 10px;
            }
            
            .modal-header {
                padding: 12px 15px;
            }
            
            .modal-body {
                padding: 15px;
            }
            
            .help-content {
                margin: 10px;
                padding: 20px;
            }
        }

        /* Print Styles */
        @media print {
            .presentation-header,
            .slide-navigation,
            .slide-navigation-bottom,
            .map-nav-button,
            .progress-bar,
            .control-btn {
                display: none !important;
            }
            
            .content-area {
                flex-direction: column;
            }
            
            .slide-content {
                padding: 20px;
            }
            
            .slide {
                page-break-inside: avoid;
                margin-bottom: 20px;
            }
            
            .sector-card {
                break-inside: avoid;
                margin-bottom: 10px;
            }
            
            body {
                background: white !important;
            }
            
            .modal-content {
                box-shadow: none !important;
                border: 1px solid #ccc !important;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --primary-blue: #0000ee;
                --primary-green: #008000;
                --text-dark: #000000;
                --text-light: #333333;
                --border-light: #666666;
            }
            
            .sector-card,
            .region-item,
            .investor-card {
                border: 2px solid #000000;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .spinner {
                animation: none;
                border: 4px solid var(--primary-blue);
            }
        }

        /* Focus-visible support for better keyboard navigation */
        .region-item:focus-visible,
        .sector-card:focus-visible,
        .control-btn:focus-visible,
        .nav-btn:focus-visible {
            outline: 3px solid var(--primary-blue);
            outline-offset: 2px;
        }

        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--light-bg);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }

        ::-webkit-scrollbar-corner {
            background: var(--light-bg);
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner" role="status" aria-label="Loading"></div>
        <div class="loading-text">Memuat Dashboard Investasi NTB</div>
        <div class="loading-subtext">Menyiapkan data dan peta interaktif...</div>
    </div>

    <!-- Help Modal -->
    <div class="help-modal" id="helpModal" role="dialog" aria-labelledby="helpTitle" aria-modal="true">
        <div class="help-content">
            <div class="help-header">
                <h3 class="help-title" id="helpTitle">
                    <i class="fas fa-keyboard"></i>
                    Bantuan & Shortcut
                </h3>
                <button class="help-close" onclick="closeHelpModal()" aria-label="Tutup bantuan">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="help-section">
                <h4><i class="fas fa-mouse"></i> Navigasi</h4>
                <div class="help-shortcuts">
                    <div class="shortcut-item">
                        <span>Slide berikutnya</span>
                        <span class="shortcut-key">→ atau Space</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Slide sebelumnya</span>
                        <span class="shortcut-key">←</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Kembali ke beranda</span>
                        <span class="shortcut-key">Home</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Buka peta NTB</span>
                        <span class="shortcut-key">M</span>
                    </div>
                </div>
            </div>
            
            <div class="help-section">
                <h4><i class="fas fa-search"></i> Pencarian</h4>
                <div class="help-shortcuts">
                    <div class="shortcut-item">
                        <span>Fokus ke pencarian</span>
                        <span class="shortcut-key">/</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Bersihkan pencarian</span>
                        <span class="shortcut-key">Esc</span>
                    </div>
                </div>
            </div>
            
            <div class="help-section">
                <h4><i class="fas fa-expand"></i> Tampilan</h4>
                <div class="help-shortcuts">
                    <div class="shortcut-item">
                        <span>Mode fullscreen</span>
                        <span class="shortcut-key">F11</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Tutup modal</span>
                        <span class="shortcut-key">Esc</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Bantuan ini</span>
                        <span class="shortcut-key">F1 atau ?</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="presentation-container">
        <!-- Header -->
        <header class="presentation-header">
            <div class="header-left">
                <div class="logo-container">
                    <img src="img/dpmptsp-logo.png" alt="Logo DPMPTSP NTB" class="logo">
                </div>
                <div class="title-section">
                    <h1>Dashboard Investasi NTB</h1>
                    <p>Dinas Penanaman Modal dan Pelayanan Terpadu Satu Pintu</p>
                </div>
            </div>
            <div class="header-right">
                <nav class="presentation-controls" role="navigation" aria-label="Kontrol presentasi">
                    <button class="control-btn active" onclick="resetPresentation()" aria-label="Kembali ke beranda">
                        <i class="fas fa-home" aria-hidden="true"></i> 
                        <span>Beranda</span>
                    </button>
                    <button class="control-btn" onclick="showMapOverview()" aria-label="Tampilkan peta NTB">
                        <i class="fas fa-map" aria-hidden="true"></i> 
                        <span>Peta NTB</span>
                    </button>
                    <button class="control-btn" onclick="showHelpModal()" aria-label="Tampilkan bantuan">
                        <i class="fas fa-question-circle" aria-hidden="true"></i> 
                        <span>Bantuan</span>
                    </button>
                    <button class="control-btn" onclick="toggleFullscreen()" aria-label="Mode layar penuh">
                        <i class="fas fa-expand" aria-hidden="true"></i> 
                        <span>Fullscreen</span>
                    </button>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="content-area" id="main-content">
            <!-- Region Navigation -->
            <aside class="slide-navigation" role="complementary" aria-label="Navigasi wilayah">
                <div class="nav-title">
                    <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                    Wilayah NTB
                </div>
                
                <!-- Search Box -->
                <div class="search-container">
                    <i class="fas fa-search search-icon" aria-hidden="true"></i>
                    <input 
                        type="text" 
                        class="search-input" 
                        id="regionSearch" 
                        placeholder="Cari wilayah..."
                        autocomplete="off"
                        aria-label="Cari wilayah di NTB"
                        role="searchbox"
                    >
                    <button class="search-clear" id="searchClear" onclick="clearSearch()" aria-label="Bersihkan pencarian">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
                
                <nav class="region-list" id="regionList" role="navigation" aria-label="Daftar wilayah NTB">
                    <!-- Regions will be populated by JavaScript -->
                </nav>
                
                <!-- No Results Message -->
                <div class="no-results" id="noResults" role="status" aria-live="polite">
                    <i class="fas fa-search" aria-hidden="true"></i>
                    <div>Tidak ada wilayah yang ditemukan</div>
                    <small>Coba kata kunci lain</small>
                </div>
            </aside>

            <!-- Slide Content -->
            <main class="slide-content" role="main">
                <!-- Welcome Slide -->
                <section class="slide active" id="welcomeSlide" aria-labelledby="welcome-title">
                    <div class="welcome-slide">
                        <div class="welcome-icon" aria-hidden="true">
                            <i class="fas fa-presentation"></i>
                        </div>
                        <h1 class="welcome-title" id="welcome-title">Presentasi Investasi NTB</h1>
                        <p class="welcome-subtitle">
                            Jelajahi data investasi real-time dari 10 kabupaten/kota di Nusa Tenggara Barat 
                            dengan detail 16 sektor ekonomi dan profil investor terkemuka.
                        </p>
                        <div class="welcome-instructions">
                            <h3><i class="fas fa-info-circle" aria-hidden="true"></i> Cara Penggunaan</h3>
                            <p>
                                • Pilih wilayah di panel kiri untuk melihat detail investasi<br>
                                • Klik sektor untuk melihat top 10 investor terbesar<br>
                                • Tekan "/" untuk fokus ke pencarian wilayah<br>
                                • Gunakan tombol navigasi untuk berpindah antar slide<br>
                                • Klik fullscreen untuk pengalaman presentasi optimal<br>
                                • Klik "Peta NTB" untuk melihat overview geografis<br>
                                • Tekan F1 atau ? untuk melihat bantuan lengkap
                            </p>
                        </div>
                    </div>
                </section>

                <!-- Map Overview Slide -->
                <section class="slide" id="mapOverviewSlide" aria-labelledby="map-title">
                    <div class="map-overview-slide">
                        <div class="map-header">
                            <div class="map-title">
                                <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
                                <h2 id="map-title">Peta Investasi NTB</h2>
                            </div>
                            <div class="map-controls">
                                <button class="map-control-btn active" onclick="resetMapView()" aria-label="Reset tampilan peta">
                                    <i class="fas fa-home" aria-hidden="true"></i> Reset View
                                </button>
                                <button class="map-control-btn" onclick="toggleMapFullscreen()" aria-label="Peta layar penuh">
                                    <i class="fas fa-expand" aria-hidden="true"></i> Fullscreen Map
                                </button>
                            </div>
                        </div>
                        <div class="map-container">
                            <div id="presentationMap" role="img" aria-label="Peta interaktif investasi NTB"></div>
                            
                            <!-- Map Legend -->
                            <div class="map-legend" role="legend" aria-label="Keterangan peta">
                                <div class="legend-title">Keterangan</div>
                                <div class="legend-items">
                                    <div class="legend-item">
                                        <div class="legend-marker ibu-kota" aria-hidden="true">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <span>Ibu Kota Provinsi</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-marker kota" aria-hidden="true">
                                            <i class="fas fa-building"></i>
                                        </div>
                                        <span>Kota</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-marker kabupaten" aria-hidden="true">
                                            <i class="fas fa-mountain"></i>
                                        </div>
                                        <span>Kabupaten</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Map Stats -->
                            <div class="map-stats" role="region" aria-label="Statistik investasi">
                                <div class="stats-title">Statistik Investasi</div>
                                <div class="stats-grid">
                                    <div class="stats-item">
                                        <div class="stats-value" id="mapTotalRegions">10</div>
                                        <div class="stats-label">Wilayah</div>
                                    </div>
                                    <div class="stats-item">
                                        <div class="stats-value" id="mapTotalCompanies">0</div>
                                        <div class="stats-label">Perusahaan</div>
                                    </div>
                                    <div class="stats-item">
                                        <div class="stats-value" id="mapTotalSectors">16</div>
                                        <div class="stats-label">Sektor</div>
                                    </div>
                                    <div class="stats-item">
                                        <div class="stats-value" id="mapTotalInvestment">0</div>
                                        <div class="stats-label">Total Investasi</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Error State for Map -->
                            <div class="error-state" id="mapError">
                                <div class="error-icon">
                                    <i class="fas fa-map-marked-alt"></i>
                                </div>
                                <div class="error-title">Gagal Memuat Peta</div>
                                <div class="error-message">
                                    Terjadi kesalahan saat memuat peta interaktif. 
                                    Silakan coba muat ulang atau periksa koneksi internet Anda.
                                </div>
                                <button class="retry-btn" onclick="retryMapLoad()" aria-label="Coba muat ulang peta">
                                    <i class="fas fa-redo"></i> Muat Ulang Peta
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Region Detail Slides will be populated by JavaScript -->
            </main>
        </main>
    </div>

    <!-- Sector Detail Modal -->
    <div class="sector-modal" id="sectorModal" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">
                    <i class="fas fa-industry" aria-hidden="true"></i>
                    <span>Detail Sektor</span>
                </h2>
                <button class="modal-close" onclick="closeSectorModal()" aria-label="Tutup modal detail sektor">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Navigation Buttons -->
    <nav class="slide-navigation-bottom" role="navigation" aria-label="Navigasi slide">
        <button class="nav-btn" id="prevBtn" onclick="previousSlide()" disabled aria-label="Slide sebelumnya">
            <i class="fas fa-chevron-left" aria-hidden="true"></i>
        </button>
        <button class="nav-btn" id="nextBtn" onclick="nextSlide()" aria-label="Slide berikutnya">
            <i class="fas fa-chevron-right" aria-hidden="true"></i>
        </button>
    </nav>

    <!-- Map Navigation Button -->
    <button class="map-nav-button" id="mapNavButton" onclick="showMapOverview()" aria-label="Lihat Peta NTB">
        <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
    </button>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar" role="progressbar" aria-label="Progress presentasi"></div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Enhanced global variables and error handling
        let presentationMap = null;
        let markersLayer = null;
        let currentSlide = 0;
        let totalSlides = 0;
        let isMapInitialized = false;
        let mapInitRetries = 0;
        const MAX_MAP_RETRIES = 3;
        const MAP_INIT_DELAY = 1000;
        
        // Performance monitoring
        const performanceMetrics = {
            initStart: performance.now(),
            mapLoadStart: null,
            mapLoadEnd: null,
            dataLoadStart: null,
            dataLoadEnd: null
        };

        // Data investasi berdasarkan file yang diberikan
        const investmentData = {
            "Mataram": {
                name: "Mataram",
                type: "Ibu Kota",
                population: "441,546",
                totalInvestment: 3044235580377,
                totalCompanies: 5,
                sectors: {
                    "Telekomunikasi": [
                        {
                            name: "XLSMART TELECOM SEJAHTERA",
                            investment: 1827358609517,
                            type: "PMA",
                            kbli: "61200",
                            district: "Mataram",
                            description: "Aktivitas Telekomunikasi Tanpa Kabel"
                        },
                        {
                            name: "INDOSAT",
                            investment: 253927304487,
                            type: "PMA",
                            kbli: "61200",
                            district: "Mataram",
                            description: "Aktivitas Telekomunikasi Tanpa Kabel"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "AGRINDO NUSANTARA",
                            investment: 727830634210,
                            type: "PMDN",
                            kbli: "46319",
                            district: "Sandubaya",
                            description: "Perdagangan Besar Bahan Makanan Dan Minuman Hasil Pertanian Lainnya"
                        },
                        {
                            name: "BINTANG BALI INDAH",
                            investment: 117033565000,
                            type: "PMDN",
                            kbli: "46333",
                            district: "Sandubaya",
                            description: "Perdagangan Besar Minuman Beralkohol"
                        }
                    ],
                    "Kelautan dan Perikanan": [
                        {
                            name: "AIR MINUM GIRI MENANG",
                            investment: 118085467163,
                            type: "PMDN",
                            kbli: "36001",
                            district: "Selaprang",
                            description: "Penampungan, Penjernihan dan Penyaluran Air Minum"
                        }
                    ]
                }
            },
            "Lombok Barat": {
                name: "Lombok Barat",
                type: "Kabupaten",
                population: "679,871",
                totalInvestment: 1797146623935,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "PELAYANAN LISTRIK NASIONAL BATAM",
                            investment: 927119472934,
                            type: "PMDN",
                            kbli: "35111",
                            district: "Gerung",
                            description: "Pembangkitan Tenaga Listrik"
                        }
                    ],
                    "Pariwisata dan Ekonomi Kreatif": [
                        {
                            name: "BLISS PEMBANGUNAN SEJAHTERA",
                            investment: 419637796264,
                            type: "PMDN",
                            kbli: "68111",
                            district: "Narmada",
                            description: "Real Estat Yang Dimiliki Sendiri Atau Disewa"
                        },
                        {
                            name: "GRAHA SENGGIGI",
                            investment: 149658714241,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Batu Layar",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "RAJAWALI ADIMANDALIKA",
                            investment: 129264000000,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Batu Layar",
                            description: "Hotel Bintang"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "NARMADA AWET MUDA",
                            investment: 171066640896,
                            type: "PMDN",
                            kbli: "11051",
                            district: "Lingsar",
                            description: "Industri Air Kemasan"
                        }
                    ]
                }
            },
            "Lombok Tengah": {
                name: "Lombok Tengah",
                type: "Kabupaten",
                population: "980,167",
                totalInvestment: 12195893056730,
                totalCompanies: 5,
                sectors: {
                    "Pariwisata dan Ekonomi Kreatif": [
                        {
                            name: "PENGEMBANGAN PARIWISATA INDONESIA",
                            investment: 9009123215123,
                            type: "PMDN",
                            kbli: "68120",
                            district: "-",
                            description: "Kawasan Pariwisata"
                        },
                        {
                            name: "LOMBOK INVEST AND DEVELOPMENT",
                            investment: 472873030683,
                            type: "PMA",
                            kbli: "55194",
                            district: "Praya Barat",
                            description: "Apartemen Hotel"
                        },
                        {
                            name: "LAPORTE KELUARGA SEJAHTRA",
                            investment: 96583321638,
                            type: "PMA",
                            kbli: "55194",
                            district: "Praya Barat",
                            description: "Apartemen Hotel"
                        }
                    ],
                    "ESDM": [
                        {
                            name: "GOODWIND POWER INDONESIA",
                            investment: 1606800000000,
                            type: "PMDN",
                            kbli: "35111",
                            district: "Pujut",
                            description: "Pembangkitan Tenaga Listrik"
                        }
                    ]
                }
            },
            "Lombok Timur": {
                name: "Lombok Timur",
                type: "Kabupaten",
                population: "1,325,240",
                totalInvestment: 1779778484656,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "PT. PERUSAHAAN LISTRIK NEGARA",
                            investment: 1407288042467,
                            type: "PMDN",
                            kbli: "35115",
                            district: "Sambelia",
                            description: "Pembangkit, Transmisi, Distribusi dan Penjualan Tenaga Listrik"
                        },
                        {
                            name: "DELAPAN MENIT ENERGI",
                            investment: 144729626405,
                            type: "PMA",
                            kbli: "35111",
                            district: "Sambelia",
                            description: "Pembangkitan Tenaga Listrik"
                        },
                        {
                            name: "IRADAT AMAN",
                            investment: 111364559251,
                            type: "PMDN",
                            kbli: "35111",
                            district: "Pringgabaya",
                            description: "Pembangkitan Tenaga Listrik"
                        }
                    ],
                    "Peternakan": [
                        {
                            name: "CHAROEN POKPHAND JAYA FARM",
                            investment: 79422227020,
                            type: "PMDN",
                            kbli: "01468",
                            district: "Pringgabaya",
                            description: "Pembibitan Ayam Ras"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "DOK DAN PERKAPALAN AIR KANTUNG",
                            investment: 36974027513,
                            type: "PMDN",
                            kbli: "33151",
                            district: "Pringgabaya",
                            description: "Reparasi Kapal, Perahu Dan Bangunan Terapung"
                        }
                    ]
                }
            },
            "Lombok Utara": {
                name: "Lombok Utara",
                type: "Kabupaten",
                population: "230,899",
                totalInvestment: 864942150646,
                totalCompanies: 5,
                sectors: {
                    "Pariwisata dan Ekonomi Kreatif": [
                        {
                            name: "WAKA OBEROI INDONESIA",
                            investment: 298277153856,
                            type: "PMA",
                            kbli: "55110",
                            district: "Tanjung",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "JAYA HAMPARAN LOMBOK",
                            investment: 166778174203,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Pemenang",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "MEKARAYA INTERNUSA",
                            investment: 162535939853,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Tanjung",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "PRAPAT AGUNG PERMAI",
                            investment: 120899357655,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Pemenang",
                            description: "Hotel Bintang"
                        },
                        {
                            name: "WALTER PROPERTINDO JAYA",
                            investment: 116451525079,
                            type: "PMDN",
                            kbli: "55113",
                            district: "Pemenang",
                            description: "Hotel Bintang Tiga"
                        }
                    ]
                }
            },
            "Sumbawa": {
                name: "Sumbawa",
                type: "Kabupaten",
                population: "439,909",
                totalInvestment: 1629958323189,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "PT. PERUSAHAAN LISTRIK NEGARA",
                            investment: 531151255969,
                            type: "PMDN",
                            kbli: "35115",
                            district: "Labuhan Badas",
                            description: "Pembangkit, Transmisi, Distribusi dan Penjualan Tenaga Listrik"
                        },
                        {
                            name: "SUMBER REJEKI POWER",
                            investment: 207753285189,
                            type: "PMDN",
                            kbli: "35111",
                            district: "Unter Iwes",
                            description: "Pembangkitan Tenaga Listrik"
                        },
                        {
                            name: "SUMBAWA JUTARAYA",
                            investment: 185480600525,
                            type: "PMDN",
                            kbli: "07301",
                            district: "Ropang",
                            description: "Pertambangan Emas Dan Perak"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "CHAROEN POKPHAND INDONESIA",
                            investment: 434477903300,
                            type: "PMDN",
                            kbli: "52101",
                            district: "Moyo Hilir",
                            description: "Pergudangan dan Penyimpanan"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "SUMBAWA JUTARAYA",
                            investment: 271595378206,
                            type: "PMDN",
                            kbli: "24201",
                            district: "Ropang",
                            description: "Industri Pembuatan Logam Dasar Mulia"
                        }
                    ]
                }
            },
            "Sumbawa Barat": {
                name: "Sumbawa Barat",
                type: "Kabupaten",
                population: "135,689",
                totalInvestment: 287498166628133,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "AMMAN MINERAL NUSA TENGGARA",
                            investment: 234990859636484,
                            type: "PMDN",
                            kbli: "07294",
                            district: "Sekongkang",
                            description: "Pertambangan Bijih Tembaga"
                        },
                        {
                            name: "MACMAHON INDONESIA",
                            investment: 17239364616487,
                            type: "PMA",
                            kbli: "09900",
                            district: "Sekongkang",
                            description: "Aktivitas Penunjang pertambangan dan penggalian lainnya"
                        },
                        {
                            name: "AMMAN MINERAL NUSA TENGGARA",
                            investment: 15775802514269,
                            type: "PMDN",
                            kbli: "07294",
                            district: "Sekongkang",
                            description: "Pertambangan Bijih Tembaga"
                        },
                        {
                            name: "JURONG ENGINEERING LESTARI",
                            investment: 2105964077594,
                            type: "PMA",
                            kbli: "43211",
                            district: "Maluk",
                            description: "Instalasi Listrik"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "AMMAN MINERAL INDUSTRI",
                            investment: 17386161163299,
                            type: "PMDN",
                            kbli: "24202",
                            district: "Maluk",
                            description: "Industri Pembuatan Logam Dasar Bukan Besi"
                        }
                    ]
                }
            },
            "Dompu": {
                name: "Dompu",
                type: "Kabupaten",
                population: "230,696",
                totalInvestment: 7984768655151,
                totalCompanies: 5,
                sectors: {
                    "ESDM": [
                        {
                            name: "SUMBAWA TIMUR MINING",
                            investment: 7802569572664,
                            type: "PMA",
                            kbli: "07301",
                            district: "Hu'u",
                            description: "Pertambangan Emas Dan Perak"
                        },
                        {
                            name: "MACMAHON MINING SERVICES",
                            investment: 27695888493,
                            type: "PMA",
                            kbli: "09900",
                            district: "Hu'u",
                            description: "Aktivitas Penunjang pertambangan dan penggalian lainnya"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "SEGER AGRO NUSANTARA",
                            investment: 69588510000,
                            type: "PMDN",
                            kbli: "46201",
                            district: "Pekat",
                            description: "Perdagangan Besar Padi Dan Palawija"
                        }
                    ],
                    "Pertanian": [
                        {
                            name: "SUKSES MANTAP SEJAHTERA",
                            investment: 47391075499,
                            type: "PMDN",
                            kbli: "01140",
                            district: "Pekat",
                            description: "Perkebunan Tebu"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "SUKSES MANTAP SEJAHTERA",
                            investment: 37523608495,
                            type: "PMDN",
                            kbli: "10721",
                            district: "Pekat",
                            description: "Industri Gula Pasir"
                        }
                    ]
                }
            },
            "Bima": {
                name: "Bima",
                type: "Kabupaten",
                population: "440,232",
                totalInvestment: 916465202413,
                totalCompanies: 5,
                sectors: {
                    "Pariwisata dan Ekonomi Kreatif": [
                        {
                            name: "TENGGARA POINT RESORT",
                            investment: 382652766534,
                            type: "PMA",
                            kbli: "55194",
                            district: "Parado",
                            description: "Vila"
                        },
                        {
                            name: "GOLDEN PALM SURYATAMA",
                            investment: 190382025581,
                            type: "PMDN",
                            kbli: "55110",
                            district: "Sape",
                            description: "Hotel Bintang"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "CHAROEN POKPHAND INDONESIA",
                            investment: 198867748959,
                            type: "PMDN",
                            kbli: "52101",
                            district: "Madapangga",
                            description: "Pergudangan dan Penyimpanan"
                        }
                    ],
                    "Kelautan dan Perikanan": [
                        {
                            name: "TIRTAMAS MUTIARA",
                            investment: 89000197224,
                            type: "PMDN",
                            kbli: "03219",
                            district: "Langgudu",
                            description: "Budidaya Biota Air Laut Lainnya"
                        }
                    ],
                    "Perindustrian": [
                        {
                            name: "SANGGARAGRO KARYAPERSADA",
                            investment: 55563464705,
                            type: "PMDN",
                            kbli: "20294",
                            district: "Tambora",
                            description: "Industri Minyak Atsiri"
                        }
                    ]
                }
            },
            "Kota Bima": {
                name: "Kota Bima",
                type: "Kota",
                population: "149,859",
                totalInvestment: 197901240959,
                totalCompanies: 3,
                sectors: {
                    "Transportasi": [
                        {
                            name: "PERUSAHAAN GAS NEGARA",
                            investment: 146299999999,
                            type: "PMDN",
                            kbli: "49300",
                            district: "Asakota",
                            description: "Angkutan Melalui Saluran Pipa"
                        }
                    ],
                    "Kesehatan": [
                        {
                            name: "RS PKU MUHAMMADIYAH BIMA",
                            investment: 33415106982,
                            type: "PMDN",
                            kbli: "86103",
                            district: "Mpunda",
                            description: "Aktivitas Rumah Sakit Swasta"
                        }
                    ],
                    "Perdagangan": [
                        {
                            name: "SAKA AGUNG ABADI",
                            investment: 18186133978,
                            type: "PMDN",
                            kbli: "46634",
                            district: "Rasanae Barat",
                            description: "Perdagangan Besar Semen, Kapur, Pasir Dan Batu"
                        }
                    ]
                }
            }
        };

        // 16 Sektor yang diminta
        const allSectors = [
            { name: "Perindustrian", icon: "fa-industry" },
            { name: "ESDM", icon: "fa-bolt" },
            { name: "Lingkungan Hidup", icon: "fa-leaf" },
            { name: "Perdagangan", icon: "fa-store" },
            { name: "Pariwisata dan Ekonomi Kreatif", icon: "fa-camera" },
            { name: "Transportasi", icon: "fa-truck" },
            { name: "Komunikasi", icon: "fa-tower-cell" },
            { name: "Keuangan", icon: "fa-coins" },
            { name: "Pertanian dan Kehutanan", icon: "fa-seedling" },
            { name: "Kelautan dan Perikanan", icon: "fa-fish" },
            { name: "PUPR", icon: "fa-building" },
            { name: "Pendidikan", icon: "fa-graduation-cap" },
            { name: "Kesehatan", icon: "fa-hospital" },
            { name: "Peternakan", icon: "fa-cow" },
            { name: "Telekomunikasi", icon: "fa-satellite-dish" },
            { name: "Pertanian", icon: "fa-wheat-awn" }
        ];

        // Coordinates for NTB regions
        const regionCoordinates = {
            "Mataram": [116.1178, -8.5833],
            "Lombok Barat": [116.1047, -8.6500],
            "Lombok Tengah": [116.3081, -8.7000],
            "Lombok Timur": [116.5472, -8.5500],
            "Lombok Utara": [116.4067, -8.3500],
            "Sumbawa": [117.4181, -8.4667],
            "Sumbawa Barat": [116.8167, -8.7167],
            "Dompu": [118.4667, -8.5333],
            "Bima": [118.7167, -8.4667],
            "Kota Bima": [118.7267, -8.4600]
        };

        const regions = Object.keys(investmentData);

        // Enhanced utility functions
        function formatCurrency(value) {
            const numValue = parseInt(value);
            if (isNaN(numValue)) return 'Rp 0';
            
            if (numValue >= 1000000000000000) {
                return `Rp ${(numValue / 1000000000000000).toFixed(1)} Kuadriliun`;
            } else if (numValue >= 1000000000000) {
                return `Rp ${(numValue / 1000000000000).toFixed(1)} Triliun`;
            } else if (numValue >= 1000000000) {
                return `Rp ${(numValue / 1000000000).toFixed(1)} Miliar`;
            } else if (numValue >= 1000000) {
                return `Rp ${(numValue / 1000000).toFixed(1)} Juta`;
            }
            return `Rp ${numValue.toLocaleString('id-ID')}`;
        }

        // Enhanced error handling utilities
        function logError(context, error, data = {}) {
            console.error(`[${context}] Error:`, error, data);
            
            // Could send to monitoring service in production
            if (window.analytics) {
                window.analytics.track('error', {
                    context,
                    error: error.message,
                    stack: error.stack,
                    ...data
                });
            }
        }

        function showErrorState(containerId, message, retryCallback = null) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const errorHtml = `
                <div class="error-state show">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="error-title">Terjadi Kesalahan</div>
                    <div class="error-message">${message}</div>
                    ${retryCallback ? `<button class="retry-btn" onclick="${retryCallback}()">Coba Lagi</button>` : ''}
                </div>
            `;
            
            container.innerHTML = errorHtml;
        }

        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.classList.add('hidden');
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 300);
            }
        }

        // Enhanced search with debouncing
        let searchTimeout;
        function debounceSearch(func, delay = 300) {
            return function(...args) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        // Keyboard navigation and accessibility
        function handleKeyboardNavigation(event) {
            // Don't interfere with search input or modal inputs
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                if (event.target.id !== 'regionSearch') {
                    return;
                }
            }

            // Don't interfere when modals are open
            if (document.querySelector('.sector-modal.active') || document.querySelector('.help-modal.active')) {
                return;
            }

            switch(event.key) {
                case 'ArrowRight':
                case ' ':
                    event.preventDefault();
                    nextSlide();
                    break;
                case 'ArrowLeft':
                    event.preventDefault();
                    previousSlide();
                    break;
                case 'Home':
                    event.preventDefault();
                    resetPresentation();
                    break;
                case 'Escape':
                    event.preventDefault();
                    closeSectorModal();
                    closeHelpModal();
                    closeMapPopups();
                    clearSearch();
                    break;
                case 'F11':
                    event.preventDefault();
                    toggleFullscreen();
                    break;
                case 'F1':
                case '?':
                    event.preventDefault();
                    showHelpModal();
                    break;
                case 'M':
                case 'm':
                    if (!event.target.matches('input, textarea')) {
                        event.preventDefault();
                        showMapOverview();
                    }
                    break;
                case '/':
                    if (!event.target.matches('input, textarea')) {
                        event.preventDefault();
                        const searchInput = document.getElementById('regionSearch');
                        if (searchInput) {
                            searchInput.focus();
                            searchInput.select();
                        }
                    }
                    break;
                case 'Enter':
                    if (event.target.classList.contains('region-item')) {
                        event.target.click();
                    } else if (event.target.classList.contains('sector-card') && !event.target.classList.contains('no-data')) {
                        event.target.click();
                    }
                    break;
            }
        }

        // Enhanced initialization with error handling
        async function initializePresentation() {
            try {
                performanceMetrics.dataLoadStart = performance.now();
                
                // Validate data first
                if (!validateData()) {
                    throw new Error('Data validation failed');
                }

                // Initialize UI components
                await populateRegionList();
                await createRegionSlides();
                updateMapStats();
                updateProgress();
                updateNavigationButtons();
                initializeSearch();
                
                performanceMetrics.dataLoadEnd = performance.now();
                
                // Initialize map with delay for better UX
                setTimeout(() => {
                    initializeMapWithRetry();
                }, 500);
                
                // Hide loading overlay
                setTimeout(hideLoadingOverlay, 1000);
                
                console.log('Presentation initialized successfully');
                console.log('Performance metrics:', {
                    totalInit: performanceMetrics.dataLoadEnd - performanceMetrics.initStart,
                    dataLoad: performanceMetrics.dataLoadEnd - performanceMetrics.dataLoadStart
                });
                
            } catch (error) {
                logError('initializePresentation', error);
                hideLoadingOverlay();
                showErrorState('main-content', 'Gagal memuat dashboard. Silakan refresh halaman.', 'location.reload');
            }
        }

        // Data validation
        function validateData() {
            try {
                if (!investmentData || typeof investmentData !== 'object') {
                    throw new Error('Invalid investment data structure');
                }

                const requiredFields = ['name', 'type', 'population', 'totalInvestment', 'totalCompanies', 'sectors'];
                
                for (const regionKey of Object.keys(investmentData)) {
                    const region = investmentData[regionKey];
                    
                    for (const field of requiredFields) {
                        if (!(field in region)) {
                            throw new Error(`Missing field ${field} in region ${regionKey}`);
                        }
                    }
                    
                    if (!regionCoordinates[regionKey]) {
                        console.warn(`Missing coordinates for region: ${regionKey}`);
                    }
                }
                
                return true;
            } catch (error) {
                logError('validateData', error);
                return false;
            }
        }

        // Enhanced map initialization with retry logic
        async function initializeMapWithRetry() {
            if (isMapInitialized) return;
            
            try {
                performanceMetrics.mapLoadStart = performance.now();
                await initializeMap();
                isMapInitialized = true;
                performanceMetrics.mapLoadEnd = performance.now();
                
                console.log('Map load time:', performanceMetrics.mapLoadEnd - performanceMetrics.mapLoadStart, 'ms');
                
            } catch (error) {
                logError('initializeMap', error, { retry: mapInitRetries });
                
                if (mapInitRetries < MAX_MAP_RETRIES) {
                    mapInitRetries++;
                    console.log(`Retrying map initialization (${mapInitRetries}/${MAX_MAP_RETRIES})`);
                    setTimeout(() => initializeMapWithRetry(), MAP_INIT_DELAY * mapInitRetries);
                } else {
                    console.error('Max map initialization retries reached');
                    showMapError();
                }
            }
        }

        function initializeMap() {
            return new Promise((resolve, reject) => {
                try {
                    const mapContainer = document.getElementById('presentationMap');
                    if (!mapContainer) {
                        throw new Error('Map container not found');
                    }

                    // Check if Leaflet is loaded
                    if (typeof L === 'undefined') {
                        throw new Error('Leaflet library not loaded');
                    }

                    // Initialize map centered on NTB
                    presentationMap = L.map('presentationMap', {
                        zoomControl: false,
                        minZoom: 7,
                        maxZoom: 12,
                        attributionControl: true
                    }).setView([-8.6500, 117.3616], 8);

                    // Add tile layer with error handling
                    const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '© OpenStreetMap contributors | Data: DPMPTSP NTB',
                        errorTileUrl: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5UaWxlIEVycm9yPC90ZXh0Pjwvc3ZnPg=='
                    });

                    tileLayer.on('tileerror', (e) => {
                        console.warn('Tile load error:', e);
                    });

                    presentationMap.addLayer(tileLayer);

                    // Add zoom control to bottom right
                    L.control.zoom({
                        position: 'bottomright'
                    }).addTo(presentationMap);

                    // Create markers layer
                    markersLayer = L.layerGroup().addTo(presentationMap);

                    // Add markers for each region
                    addRegionMarkers();

                    // Map event handlers
                    presentationMap.on('zoomend moveend', () => {
                        // Optional: Update map stats based on visible area
                    });

                    presentationMap.on('error', (e) => {
                        throw new Error(`Map error: ${e.message}`);
                    });

                    resolve();
                    
                } catch (error) {
                    reject(error);
                }
            });
        }

        function showMapError() {
            const mapError = document.getElementById('mapError');
            const mapContainer = document.querySelector('#presentationMap');
            
            if (mapError && mapContainer) {
                mapContainer.style.display = 'none';
                mapError.classList.add('show');
            }
        }

        function retryMapLoad() {
            const mapError = document.getElementById('mapError');
            const mapContainer = document.querySelector('#presentationMap');
            
            if (mapError && mapContainer) {
                mapError.classList.remove('show');
                mapContainer.style.display = 'block';
            }
            
            mapInitRetries = 0;
            isMapInitialized = false;
            
            // Cleanup existing map
            if (presentationMap) {
                try {
                    presentationMap.remove();
                    presentationMap = null;
                    markersLayer = null;
                } catch (e) {
                    console.warn('Error cleaning up map:', e);
                }
            }
            
            initializeMapWithRetry();
        }

        function addRegionMarkers() {
            if (!markersLayer) {
                console.error('Markers layer not initialized');
                return;
            }

            regions.forEach(regionKey => {
                const region = investmentData[regionKey];
                const coords = regionCoordinates[regionKey];
                
                if (!coords || !region) {
                    console.warn(`Missing data for region: ${regionKey}`);
                    return;
                }

                try {
                    // Calculate marker size based on investment
                    const investmentValue = region.totalInvestment;
                    let markerSize = 15;
                    if (investmentValue > 100000000000000) markerSize = 25;
                    else if (investmentValue > 10000000000000) markerSize = 22;
                    else if (investmentValue > 1000000000000) markerSize = 20;
                    else if (investmentValue > 100000000000) markerSize = 18;

                    // Determine marker style based on region type
                    let markerColor, markerIcon;
                    if (region.type === 'Ibu Kota') {
                        markerColor = 'linear-gradient(135deg, #f093fb, #f5576c)';
                        markerIcon = 'fa-star';
                    } else if (region.type === 'Kota') {
                        markerColor = 'linear-gradient(135deg, #4facfe, #00f2fe)';
                        markerIcon = 'fa-building';
                    } else {
                        markerColor = 'linear-gradient(135deg, #667eea, #764ba2)';
                        markerIcon = 'fa-mountain';
                    }

                    // Create custom marker
                    const customIcon = L.divIcon({
                        html: `
                            <div style="
                                width: ${markerSize * 2}px;
                                height: ${markerSize * 2}px;
                                background: ${markerColor};
                                border: 3px solid white;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: ${markerSize * 0.6}px;
                                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                                cursor: pointer;
                                transition: all 0.3s ease;
                                animation: markerPulse 2s infinite;
                            ">
                                <i class="fas ${markerIcon}"></i>
                            </div>
                        `,
                        className: 'custom-map-marker',
                        iconSize: [markerSize * 2, markerSize * 2],
                        iconAnchor: [markerSize, markerSize]
                    });

                    // Create marker
                    const marker = L.marker([coords[1], coords[0]], { icon: customIcon });

                    // Create popup content
                    const popupContent = createMapPopupContent(region, regionKey);
                    
                    marker.bindPopup(popupContent, {
                        maxWidth: 300,
                        className: 'custom-map-popup',
                        closeButton: true,
                        autoClose: false,
                        autoPan: true,
                        keepInView: true
                    });

                    // Add hover effects for tooltip only
                    marker.on('mouseover', function() {
                        if (!this.isPopupOpen()) {
                            this.openTooltip();
                        }
                    });

                    marker.on('mouseout', function() {
                        this.closeTooltip();
                    });

                    // Add click handler to open popup
                    marker.on('click', function(e) {
                        // Close all other popups first
                        presentationMap.eachLayer(function(layer) {
                            if (layer !== marker && layer.closePopup) {
                                layer.closePopup();
                            }
                        });
                        
                        // Open this popup
                        this.openPopup();
                        
                        // Prevent event bubbling
                        L.DomEvent.stopPropagation(e);
                    });

                    // Add tooltip
                    marker.bindTooltip(`
                        <div style="text-align: center; font-weight: 600;">
                            <div>${region.name}</div>
                            <div style="font-size: 10px; opacity: 0.8;">${formatCurrency(region.totalInvestment)}</div>
                        </div>
                    `, {
                        permanent: false,
                        direction: 'top',
                        className: 'custom-map-tooltip',
                        offset: [0, -10]
                    });

                    markersLayer.addLayer(marker);
                } catch (error) {
                    logError(`createMarker-${regionKey}`, error);
                }
            });
        }

        function createMapPopupContent(region, regionKey) {
            const activeSectors = Object.keys(region.sectors).length;
            
            return `
                <div class="map-popup">
                    <div class="popup-header">
                        <div class="popup-region-name">${region.name}</div>
                        <div class="popup-region-type">${region.type}</div>
                    </div>
                    <div class="popup-body">
                        <div class="popup-stats">
                            <div class="popup-stat">
                                <div class="popup-stat-value">${region.totalCompanies}</div>
                                <div class="popup-stat-label">Perusahaan</div>
                            </div>
                            <div class="popup-stat">
                                <div class="popup-stat-value">${activeSectors}</div>
                                <div class="popup-stat-label">Sektor Aktif</div>
                            </div>
                        </div>
                        <div style="text-align: center; margin: 10px 0;">
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--primary-green);">
                                ${formatCurrency(region.totalInvestment)}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">
                                Total Investasi
                            </div>
                        </div>
                        <div class="popup-actions">
                            <button class="popup-btn primary" onclick="goToRegionDetail('${regionKey}'); event.stopPropagation();" aria-label="Lihat detail ${region.name}">
                                <i class="fas fa-chart-bar"></i> Detail
                            </button>
                            <button class="popup-btn secondary" onclick="closeMapPopups(); event.stopPropagation();" aria-label="Tutup popup">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateMapStats() {
            try {
                const totalCompanies = regions.reduce((sum, regionKey) => 
                    sum + (investmentData[regionKey]?.totalCompanies || 0), 0);
                const totalInvestment = regions.reduce((sum, regionKey) => 
                    sum + (investmentData[regionKey]?.totalInvestment || 0), 0);

                const mapTotalCompanies = document.getElementById('mapTotalCompanies');
                const mapTotalInvestment = document.getElementById('mapTotalInvestment');
                
                if (mapTotalCompanies) mapTotalCompanies.textContent = totalCompanies;
                if (mapTotalInvestment) mapTotalInvestment.textContent = formatCurrency(totalInvestment);
            } catch (error) {
                logError('updateMapStats', error);
            }
        }

        // Enhanced region list population
        async function populateRegionList() {
            try {
                const regionList = document.getElementById('regionList');
                if (!regionList) throw new Error('Region list container not found');
                
                regionList.innerHTML = '';

                regions.forEach((regionKey, index) => {
                    const region = investmentData[regionKey];
                    const regionItem = document.createElement('div');
                    regionItem.className = 'region-item';
                    regionItem.setAttribute('data-region', regionKey);
                    regionItem.setAttribute('data-slide', index + 2); // +2 for welcome and map slides
                    regionItem.setAttribute('data-search', region.name.toLowerCase());
                    regionItem.setAttribute('tabindex', '0');
                    regionItem.setAttribute('role', 'button');
                    regionItem.setAttribute('aria-label', `Lihat detail investasi ${region.name}`);
                    
                    regionItem.innerHTML = `
                        <div class="region-name">${region.name}</div>
                        <div class="region-stats">
                            <span>${region.totalCompanies} Perusahaan</span>
                            <span class="region-investment">${formatCurrency(region.totalInvestment)}</span>
                        </div>
                    `;
                    
                    regionItem.addEventListener('click', () => {
                        showRegionSlide(index + 2);
                        updateActiveRegion(regionKey);
                    });
                    
                    regionItem.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            regionItem.click();
                        }
                    });
                    
                    regionList.appendChild(regionItem);
                });
                
                totalSlides = regions.length + 2; // +2 for welcome and map slides
                
            } catch (error) {
                logError('populateRegionList', error);
                throw error;
            }
        }

        // Enhanced search initialization
        function initializeSearch() {
            try {
                const searchInput = document.getElementById('regionSearch');
                const searchClear = document.getElementById('searchClear');
                
                if (!searchInput || !searchClear) return;
                
                const debouncedFilter = debounceSearch(filterRegions);
                
                searchInput.addEventListener('input', function(e) {
                    const query = e.target.value.toLowerCase().trim();
                    
                    if (query.length > 0) {
                        searchClear.classList.add('show');
                        debouncedFilter(query);
                    } else {
                        searchClear.classList.remove('show');
                        showAllRegions();
                    }
                });
                
                searchInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        clearSearch();
                    } else if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        const firstVisibleRegion = document.querySelector('.region-item:not(.hidden)');
                        if (firstVisibleRegion) {
                            firstVisibleRegion.focus();
                        }
                    }
                });
                
                // Add ARIA live region for search results
                const searchResults = document.createElement('div');
                searchResults.id = 'searchResults';
                searchResults.setAttribute('aria-live', 'polite');
                searchResults.setAttribute('aria-atomic', 'true');
                searchResults.style.position = 'absolute';
                searchResults.style.left = '-9999px';
                document.body.appendChild(searchResults);
                
            } catch (error) {
                logError('initializeSearch', error);
            }
        }

        function filterRegions(query) {
            try {
                const regionItems = document.querySelectorAll('.region-item');
                const noResults = document.getElementById('noResults');
                const searchResults = document.getElementById('searchResults');
                let visibleCount = 0;
                
                regionItems.forEach(item => {
                    const searchText = item.getAttribute('data-search');
                    const regionName = item.querySelector('.region-name').textContent.toLowerCase();
                    
                    if (searchText.includes(query) || regionName.includes(query)) {
                        item.classList.remove('hidden');
                        visibleCount++;
                    } else {
                        item.classList.add('hidden');
                    }
                });
                
                if (visibleCount === 0) {
                    noResults.classList.add('show');
                    if (searchResults) {
                        searchResults.textContent = 'Tidak ada wilayah yang ditemukan';
                    }
                } else {
                    noResults.classList.remove('show');
                    if (searchResults) {
                        searchResults.textContent = `${visibleCount} wilayah ditemukan`;
                    }
                }
            } catch (error) {
                logError('filterRegions', error);
            }
        }

        function showAllRegions() {
            try {
                const regionItems = document.querySelectorAll('.region-item');
                const noResults = document.getElementById('noResults');
                const searchResults = document.getElementById('searchResults');
                
                regionItems.forEach(item => {
                    item.classList.remove('hidden');
                });
                
                noResults.classList.remove('show');
                if (searchResults) {
                    searchResults.textContent = '';
                }
            } catch (error) {
                logError('showAllRegions', error);
            }
        }

        function clearSearch() {
            try {
                const searchInput = document.getElementById('regionSearch');
                const searchClear = document.getElementById('searchClear');
                
                if (searchInput) {
                    searchInput.value = '';
                    searchInput.focus();
                }
                
                if (searchClear) {
                    searchClear.classList.remove('show');
                }
                
                showAllRegions();
            } catch (error) {
                logError('clearSearch', error);
            }
        }

        // Help modal functions
        function showHelpModal() {
            const helpModal = document.getElementById('helpModal');
            if (helpModal) {
                helpModal.classList.add('active');
                
                // Focus management
                const helpClose = helpModal.querySelector('.help-close');
                if (helpClose) {
                    helpClose.focus();
                }
                
                // Trap focus within modal
                trapFocus(helpModal);
            }
        }

        function closeHelpModal() {
            const helpModal = document.getElementById('helpModal');
            if (helpModal) {
                helpModal.classList.remove('active');
            }
        }

        // Enhanced modal functions with focus management
        function trapFocus(element) {
            const focusableElements = element.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstFocusable = focusableElements[0];
            const lastFocusable = focusableElements[focusableElements.length - 1];

            element.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstFocusable) {
                            e.preventDefault();
                            lastFocusable.focus();
                        }
                    } else {
                        if (document.activeElement === lastFocusable) {
                            e.preventDefault();
                            firstFocusable.focus();
                        }
                    }
                }
            });
        }

        // Enhanced sector modal functions
        function showSectorDetail(sectorName, regionKey) {
            try {
                const region = investmentData[regionKey];
                const sectorData = region.sectors[sectorName] || [];
                
                if (sectorData.length === 0) return;
                
                // Sort by investment amount
                const sortedInvestors = [...sectorData].sort((a, b) => b.investment - a.investment);
                
                const modal = document.getElementById('sectorModal');
                const modalTitle = document.getElementById('modalTitle');
                const modalBody = document.getElementById('modalBody');
                
                if (!modal || !modalTitle || !modalBody) return;
                
                const sectorIcon = allSectors.find(s => s.name === sectorName)?.icon || 'fa-chart-line';
                
                modalTitle.innerHTML = `
                    <i class="fas ${sectorIcon}" aria-hidden="true"></i>
                    <span>${sectorName} - ${region.name}</span>
                `;
                
                const investorCards = sortedInvestors.map((investor, index) => {
                    const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                    
                    return `
                        <article class="investor-card">
                            <div class="investor-rank">
                                <div class="rank-number ${rankClass}" aria-label="Peringkat ${index + 1}">${index + 1}</div>
                                <div class="investor-name">${investor.name}</div>
                                <div class="investor-type ${investor.type}">${investor.type}</div>
                            </div>
                            <div class="investor-details">
                                <div class="detail-item">
                                    <i class="fas fa-map-marker-alt detail-icon" aria-hidden="true"></i>
                                    <span>${investor.district}</span>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-code detail-icon" aria-hidden="true"></i>
                                    <span>KBLI: ${investor.kbli}</span>
                                </div>
                            </div>
                            <div class="investor-investment">${formatCurrency(investor.investment)}</div>
                            <div style="margin-top: 10px; padding: 10px; background: var(--light-bg); border-radius: 8px; font-size: 0.85rem; color: var(--text-light);">
                                ${investor.description}
                            </div>
                        </article>
                    `;
                }).join('');
                
                modalBody.innerHTML = `
                    <div class="top-investors-grid">
                        ${investorCards}
                    </div>
                `;
                
                modal.classList.add('active');
                
                // Focus management
                const modalClose = modal.querySelector('.modal-close');
                if (modalClose) {
                    modalClose.focus();
                }
                
                trapFocus(modal);
                
            } catch (error) {
                logError('showSectorDetail', error, { sectorName, regionKey });
            }
        }

        function closeSectorModal() {
            const modal = document.getElementById('sectorModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // Enhanced slide management functions
        function showRegionSlide(slideNumber) {
            try {
                // Hide all slides
                document.querySelectorAll('.slide').forEach(slide => {
                    slide.classList.remove('active');
                });
                
                // Show target slide
                if (slideNumber === 0) {
                    document.getElementById('welcomeSlide').classList.add('active');
                    currentSlide = 0;
                } else if (slideNumber === 'map' || slideNumber === 1) {
                    document.getElementById('mapOverviewSlide').classList.add('active');
                    currentSlide = 1;
                    // Refresh map after showing
                    setTimeout(() => {
                        if (presentationMap) {
                            try {
                                presentationMap.invalidateSize();
                            } catch (error) {
                                logError('mapInvalidateSize', error);
                            }
                        }
                    }, 100);
                } else {
                    const regionSlideIndex = slideNumber - 2; // Adjust for welcome and map slides
                    const targetSlide = document.getElementById(`slide-${regionSlideIndex + 1}`);
                    if (targetSlide) {
                        targetSlide.classList.add('active');
                    }
                    currentSlide = slideNumber;
                }
                
                updateProgress();
                updateNavigationButtons();
                updateMapNavButton();
                
            } catch (error) {
                logError('showRegionSlide', error, { slideNumber });
            }
        }

        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                const nextSlideNumber = currentSlide + 1;
                showRegionSlide(nextSlideNumber);
                
                if (nextSlideNumber > 1) { // Region slides start from index 2
                    const regionKey = regions[nextSlideNumber - 2];
                    updateActiveRegion(regionKey);
                } else {
                    document.querySelectorAll('.region-item').forEach(item => {
                        item.classList.remove('active');
                    });
                }
            }
        }

        function previousSlide() {
            if (currentSlide > 0) {
                const prevSlideNumber = currentSlide - 1;
                showRegionSlide(prevSlideNumber);
                
                if (prevSlideNumber > 1) { // Region slides start from index 2
                    const regionKey = regions[prevSlideNumber - 2];
                    updateActiveRegion(regionKey);
                } else {
                    document.querySelectorAll('.region-item').forEach(item => {
                        item.classList.remove('active');
                    });
                }
            }
        }

        function updateActiveRegion(regionKey) {
            try {
                document.querySelectorAll('.region-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeItem = document.querySelector(`[data-region="${regionKey}"]`);
                if (activeItem) {
                    activeItem.classList.add('active');
                    
                    // Scroll into view if needed
                    activeItem.scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest'
                    });
                }
            } catch (error) {
                logError('updateActiveRegion', error, { regionKey });
            }
        }

        function updateNavigationButtons() {
            try {
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                
                if (prevBtn) {
                    prevBtn.disabled = currentSlide === 0;
                    prevBtn.setAttribute('aria-label', 
                        currentSlide === 0 ? 'Slide sebelumnya (tidak tersedia)' : 'Slide sebelumnya');
                }
                
                if (nextBtn) {
                    nextBtn.disabled = currentSlide === totalSlides - 1;
                    nextBtn.setAttribute('aria-label', 
                        currentSlide === totalSlides - 1 ? 'Slide berikutnya (tidak tersedia)' : 'Slide berikutnya');
                }
            } catch (error) {
                logError('updateNavigationButtons', error);
            }
        }

        function updateProgress() {
            try {
                const progressBar = document.getElementById('progressBar');
                if (progressBar) {
                    const progress = totalSlides > 1 ? (currentSlide / (totalSlides - 1)) * 100 : 0;
                    progressBar.style.width = `${progress}%`;
                    progressBar.setAttribute('aria-valuenow', Math.round(progress));
                    progressBar.setAttribute('aria-valuetext', `${currentSlide + 1} dari ${totalSlides} slide`);
                }
            } catch (error) {
                logError('updateProgress', error);
            }
        }

        function updateMapNavButton() {
            try {
                const mapNavButton = document.getElementById('mapNavButton');
                if (mapNavButton) {
                    if (currentSlide === 1) { // Map slide
                        mapNavButton.style.display = 'none';
                    } else {
                        mapNavButton.style.display = 'flex';
                    }
                }
            } catch (error) {
                logError('updateMapNavButton', error);
            }
        }

        // Enhanced region slides creation
        async function createRegionSlides() {
            try {
                const slideContent = document.querySelector('.slide-content');
                if (!slideContent) throw new Error('Slide content container not found');
                
                regions.forEach((regionKey, index) => {
                    const region = investmentData[regionKey];
                    const slide = document.createElement('section');
                    slide.className = 'slide';
                    slide.id = `slide-${index + 1}`;
                    slide.setAttribute('aria-labelledby', `region-title-${index}`);
                    
                    // Get sectors for this region
                    const regionSectors = Object.keys(region.sectors);
                    
                    // Create sector cards with data from the region
                    const sectorCards = allSectors.map(sector => {
                        const hasData = regionSectors.includes(sector.name);
                        const sectorData = hasData ? region.sectors[sector.name] : [];
                        const totalInvestment = sectorData.reduce((sum, investor) => sum + investor.investment, 0);
                        
                        return `
                            <article class="sector-card ${hasData ? '' : 'no-data'}" 
                                     data-has-data="${hasData}"
                                     tabindex="0"
                                     role="button"
                                     aria-label="${hasData ? `Lihat detail sektor ${sector.name} dengan ${sectorData.length} investor` : `Sektor ${sector.name} tidak memiliki data`}"
                                     ${hasData ? `onclick="showSectorDetail('${sector.name}', '${regionKey}')"` : ''}>
                                <div class="sector-header">
                                    <div class="sector-icon" aria-hidden="true">
                                        <i class="fas ${sector.icon}"></i>
                                    </div>
                                    <div class="sector-info">
                                        <h3>${sector.name}</h3>
                                        <div class="sector-count">
                                            ${hasData ? `${sectorData.length} Investor` : 'Tidak ada data'}
                                        </div>
                                    </div>
                                </div>
                                <div class="sector-stats">
                                    <div class="sector-investment">
                                        ${hasData ? formatCurrency(totalInvestment) : '-'}
                                    </div>
                                    <div class="sector-arrow" aria-hidden="true">
                                        <i class="fas fa-chevron-right"></i>
                                    </div>
                                </div>
                            </article>
                        `;
                    }).join('');
                    
                    slide.innerHTML = `
                        <div class="region-detail-header">
                            <div class="region-detail-title">
                                <div class="region-icon" aria-hidden="true">
                                    <i class="fas ${region.type === 'Ibu Kota' ? 'fa-star' : region.type === 'Kota' ? 'fa-building' : 'fa-mountain'}"></i>
                                </div>
                                <div class="region-title-text">
                                    <h2 id="region-title-${index}">${region.name}</h2>
                                    <p>${region.type} • Populasi: ${region.population} jiwa</p>
                                </div>
                            </div>
                            <div class="region-stats-summary" role="region" aria-label="Statistik investasi ${region.name}">
                                <div class="stat-item">
                                    <div class="stat-value">${region.totalCompanies}</div>
                                    <div class="stat-label">Perusahaan</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${Object.keys(region.sectors).length}</div>
                                    <div class="stat-label">Sektor Aktif</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${formatCurrency(region.totalInvestment)}</div>
                                    <div class="stat-label">Total Investasi</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sector-controls">
                            <button class="sector-toggle" 
                                    id="toggleSector-${index}" 
                                    onclick="toggleSectorFilter('${regionKey}', ${index})"
                                    aria-label="Filter sektor aktif">
                                <i class="fas fa-filter" aria-hidden="true"></i>
                                <span>Hanya Sektor Aktif</span>
                            </button>
                            <div class="sector-count-info" id="sectorCount-${index}" role="status" aria-live="polite">
                                Menampilkan ${allSectors.length} dari ${allSectors.length} sektor
                            </div>
                        </div>
                        
                        <div class="sectors-grid" id="sectorsGrid-${index}" role="grid" aria-label="Daftar sektor ekonomi">
                            ${sectorCards}
                        </div>
                    `;
                    
                    slideContent.appendChild(slide);
                });
                
                // Add keyboard navigation to sector cards
                document.addEventListener('keydown', (e) => {
                    if (e.target.classList.contains('sector-card') && (e.key === 'Enter' || e.key === ' ')) {
                        e.preventDefault();
                        if (!e.target.classList.contains('no-data')) {
                            e.target.click();
                        }
                    }
                });
                
            } catch (error) {
                logError('createRegionSlides', error);
                throw error;
            }
        }

        // Enhanced sector filter function
        function toggleSectorFilter(regionKey, slideIndex) {
            try {
                const toggle = document.getElementById(`toggleSector-${slideIndex}`);
                const grid = document.getElementById(`sectorsGrid-${slideIndex}`);
                const countInfo = document.getElementById(`sectorCount-${slideIndex}`);
                
                if (!toggle || !grid || !countInfo) return;
                
                const isActive = toggle.classList.contains('active');
                const region = investmentData[regionKey];
                const activeSectors = Object.keys(region.sectors).length;
                
                if (isActive) {
                    // Show all sectors
                    toggle.classList.remove('active');
                    toggle.querySelector('span').textContent = 'Hanya Sektor Aktif';
                    toggle.setAttribute('aria-label', 'Filter sektor aktif');
                    
                    const cards = grid.querySelectorAll('.sector-card');
                    cards.forEach(card => {
                        card.style.display = 'flex';
                    });
                    
                    countInfo.textContent = `Menampilkan ${allSectors.length} dari ${allSectors.length} sektor`;
                } else {
                    // Show only active sectors
                    toggle.classList.add('active');
                    toggle.querySelector('span').textContent = 'Semua Sektor';
                    toggle.setAttribute('aria-label', 'Tampilkan semua sektor');
                    
                    const cards = grid.querySelectorAll('.sector-card');
                    cards.forEach(card => {
                        const hasData = card.getAttribute('data-has-data') === 'true';
                        card.style.display = hasData ? 'flex' : 'none';
                    });
                    
                    countInfo.textContent = `Menampilkan ${activeSectors} dari ${allSectors.length} sektor`;
                }
            } catch (error) {
                logError('toggleSectorFilter', error, { regionKey, slideIndex });
            }
        }

        // Map functions
        function showMapOverview() {
            showRegionSlide('map');
            
            // Refresh map size after showing
            setTimeout(() => {
                if (presentationMap) {
                    try {
                        presentationMap.invalidateSize();
                        presentationMap.setView([-8.6500, 117.3616], 8);
                    } catch (error) {
                        logError('mapRefresh', error);
                    }
                }
            }, 300);
        }

        function resetMapView() {
            if (presentationMap) {
                try {
                    presentationMap.setView([-8.6500, 117.3616], 8);
                    closeMapPopups();
                } catch (error) {
                    logError('resetMapView', error);
                }
            }
        }

        function toggleMapFullscreen() {
            const mapContainer = document.querySelector('.map-container');
            if (mapContainer) {
                try {
                    if (mapContainer.requestFullscreen) {
                        mapContainer.requestFullscreen();
                    } else if (mapContainer.webkitRequestFullscreen) {
                        mapContainer.webkitRequestFullscreen();
                    } else if (mapContainer.msRequestFullscreen) {
                        mapContainer.msRequestFullscreen();
                    }
                    
                    setTimeout(() => {
                        if (presentationMap) {
                            presentationMap.invalidateSize();
                        }
                    }, 100);
                } catch (error) {
                    logError('toggleMapFullscreen', error);
                }
            }
        }

        function goToRegionDetail(regionKey) {
            try {
                const slideIndex = regions.indexOf(regionKey) + 2; // +2 for welcome and map slides
                if (slideIndex >= 2) {
                    showRegionSlide(slideIndex);
                    updateActiveRegion(regionKey);
                    closeMapPopups();
                }
            } catch (error) {
                logError('goToRegionDetail', error, { regionKey });
            }
        }

        function closeMapPopups() {
            if (presentationMap) {
                try {
                    presentationMap.closePopup();
                    presentationMap.eachLayer(function(layer) {
                        if (layer.closePopup) {
                            layer.closePopup();
                        }
                        if (layer.closeTooltip) {
                            layer.closeTooltip();
                        }
                    });
                } catch (error) {
                    logError('closeMapPopups', error);
                }
            }
        }

        // Presentation control functions
        function resetPresentation() {
            try {
                showRegionSlide(0);
                document.querySelectorAll('.region-item').forEach(item => {
                    item.classList.remove('active');
                });
                closeSectorModal();
                closeHelpModal();
                closeMapPopups();
                clearSearch();
                
                // Update control buttons
                document.querySelectorAll('.control-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.control-btn[onclick="resetPresentation()"]')?.classList.add('active');
                
            } catch (error) {
                logError('resetPresentation', error);
            }
        }

        function toggleFullscreen() {
            try {
                if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
                    if (document.documentElement.requestFullscreen) {
                        document.documentElement.requestFullscreen();
                    } else if (document.documentElement.webkitRequestFullscreen) {
                        document.documentElement.webkitRequestFullscreen();
                    } else if (document.documentElement.msRequestFullscreen) {
                        document.documentElement.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }
            } catch (error) {
                logError('toggleFullscreen', error);
            }
        }

        // Event listeners and initialization
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Add ARIA attributes to progress bar
                const progressBar = document.getElementById('progressBar');
                if (progressBar) {
                    progressBar.setAttribute('role', 'progressbar');
                    progressBar.setAttribute('aria-valuemin', '0');
                    progressBar.setAttribute('aria-valuemax', '100');
                    progressBar.setAttribute('aria-valuenow', '0');
                }

                // Initialize presentation
                initializePresentation();
                
                // Add keyboard navigation
                document.addEventListener('keydown', handleKeyboardNavigation);
                
                // Add window resize handler for map
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        if (presentationMap) {
                            try {
                                presentationMap.invalidateSize();
                            } catch (error) {
                                logError('windowResize', error);
                            }
                        }
                    }, 250);
                });

                // Close modals when clicking outside
                document.getElementById('sectorModal')?.addEventListener('click', (e) => {
                    if (e.target.id === 'sectorModal') {
                        closeSectorModal();
                    }
                });

                document.getElementById('helpModal')?.addEventListener('click', (e) => {
                    if (e.target.id === 'helpModal') {
                        closeHelpModal();
                    }
                });

                // Handle fullscreen changes
                document.addEventListener('fullscreenchange', handleFullscreenChange);
                document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
                document.addEventListener('msfullscreenchange', handleFullscreenChange);

                function handleFullscreenChange() {
                    setTimeout(() => {
                        if (presentationMap) {
                            try {
                                presentationMap.invalidateSize();
                            } catch (error) {
                                logError('fullscreenChange', error);
                            }
                        }
                    }, 100);
                }

                // Add performance monitoring
                if (typeof PerformanceObserver !== 'undefined') {
                    const observer = new PerformanceObserver((list) => {
                        for (const entry of list.getEntries()) {
                            if (entry.entryType === 'navigation') {
                                console.log('Page load performance:', {
                                    domContentLoaded: entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart,
                                    loadComplete: entry.loadEventEnd - entry.loadEventStart
                                });
                            }
                        }
                    });
                    observer.observe({ entryTypes: ['navigation'] });
                }

                console.log('Dashboard initialized successfully');
                
            } catch (error) {
                logError('DOMContentLoaded', error);
                hideLoadingOverlay();
                
                // Fallback error message
                document.body.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column; text-align: center; padding: 20px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #dc2626; margin-bottom: 20px;"></i>
                        <h1 style="color: #1f2937; margin-bottom: 10px;">Gagal Memuat Dashboard</h1>
                        <p style="color: #6b7280; margin-bottom: 20px;">Terjadi kesalahan saat memuat dashboard investasi NTB.</p>
                        <button onclick="location.reload()" style="padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Muat Ulang Halaman
                        </button>
                    </div>
                `;
            }
        });

        // Add marker pulse animation and custom styles
        const markerStyle = document.createElement('style');
        markerStyle.textContent = `
            @keyframes markerPulse {
                0% { box-shadow: 0 4px 12px rgba(0,0,0,0.3), 0 0 0 0 rgba(102, 126, 234, 0.7); }
                70% { box-shadow: 0 4px 12px rgba(0,0,0,0.3), 0 0 0 10px rgba(102, 126, 234, 0); }
                100% { box-shadow: 0 4px 12px rgba(0,0,0,0.3), 0 0 0 0 rgba(102, 126, 234, 0); }
            }
            
            .custom-map-marker:hover {
                transform: scale(1.2) !important;
                z-index: 1000 !important;
            }
            
            .custom-map-tooltip {
                background: rgba(255, 255, 255, 0.95) !important;
                border: none !important;
                border-radius: 8px !important;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
                padding: 8px 12px !important;
                font-size: 12px !important;
                color: #333 !important;
            }
            
            .leaflet-tooltip-top:before {
                border-top-color: rgba(255, 255, 255, 0.95) !important;
            }
            
            .leaflet-popup {
                z-index: 1002 !important;
            }
            
            .leaflet-popup-pane {
                z-index: 1002 !important;
            }
            
            .popup-btn {
                cursor: pointer !important;
                border: none !important;
                outline: none !important;
                user-select: none !important;
            }
            
            /* Focus indicators for better accessibility */
            .region-item:focus-visible,
            .sector-card:focus-visible,
            .control-btn:focus-visible,
            .nav-btn:focus-visible,
            .map-control-btn:focus-visible {
                outline: 3px solid var(--primary-blue) !important;
                outline-offset: 2px !important;
            }
            
            /* High contrast support */
            @media (prefers-contrast: high) {
                .sector-card,
                .region-item,
                .investor-card {
                    border: 2px solid #000000 !important;
                }
            }
            
            /* Reduced motion support */
            @media (prefers-reduced-motion: reduce) {
                .spinner {
                    animation: none !important;
                    border: 4px solid var(--primary-blue) !important;
                }
                
                .sector-card:hover,
                .region-item:hover,
                .nav-btn:hover {
                    transform: none !important;
                }
            }
        `;
        document.head.appendChild(markerStyle);

        // Export functions for global access
        window.showSectorDetail = showSectorDetail;
        window.closeSectorModal = closeSectorModal;
        window.showHelpModal = showHelpModal;
        window.closeHelpModal = closeHelpModal;
        window.resetPresentation = resetPresentation;
        window.showMapOverview = showMapOverview;
        window.toggleFullscreen = toggleFullscreen;
        window.nextSlide = nextSlide;
        window.previousSlide = previousSlide;
        window.clearSearch = clearSearch;
        window.toggleSectorFilter = toggleSectorFilter;
        window.resetMapView = resetMapView;
        window.toggleMapFullscreen = toggleMapFullscreen;
        window.goToRegionDetail = goToRegionDetail;
        window.closeMapPopups = closeMapPopups;
        window.retryMapLoad = retryMapLoad;
    </script>
</body>
</html>